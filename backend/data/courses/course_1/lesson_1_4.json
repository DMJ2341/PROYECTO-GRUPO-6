{
  "id": "c1_l4",
  "title": "Malware y T√©cnicas de Ataque",
  "description": "Anatom√≠a de WannaCry: C√≥mo Funciona el Ransomware",
  "type": "interactive",
  "duration_minutes": 22,
  "xp_reward": 60,
  "order_index": 4,
  "course_id": 1,
  "total_screens": 19,
  "theme": {
    "primary_color": "#9C27B0",
    "secondary_color": "#F44336",
    "accent_color": "#00BCD4",
    "gradient": ["#1a1a2e", "#2d132c", "#4a1942"]
  },
  "screens": [
    {
      "screen_id": 1,
      "type": "story_intro",
      "title": "Laboratorio de Malware",
      "content": {
        "headline": "ANATOM√çA DEL RANSOMWARE",
        "subheadline": "Disecciona WannaCry componente por componente",
        "background_image": "malware_lab",
        "stats": [
          {"value": "5", "label": "Componentes del malware"},
          {"value": "RSA+AES", "label": "Cifrado h√≠brido"},
          {"value": "445", "label": "Puerto de propagaci√≥n"}
        ],
        "cta_text": "Iniciar An√°lisis"
      }
    },
    {
      "screen_id": 2,
      "type": "flip_card_full",
      "title": "¬øQu√© es Malware?",
      "content": {
        "card": {
          "front": {
            "icon": "bug_report",
            "term": "MALWARE",
            "subtitle": "Malicious Software",
            "color": "#9C27B0"
          },
          "back": {
            "definition": "Software dise√±ado para da√±ar, infiltrar o tomar control de sistemas sin consentimiento",
            "categories": [
              "Virus - Se adjunta a archivos",
              "Worm - Se auto-propaga",
              "Trojan - Se disfraza de software leg√≠timo",
              "Ransomware - Cifra y exige rescate",
              "Spyware - Esp√≠a actividad del usuario"
            ],
            "color": "#7B1FA2"
          }
        }
      }
    },
    {
      "screen_id": 3,
      "type": "swipe_cards",
      "title": "Clasifica el Malware",
      "content": {
        "instruction": "Desliza para clasificar cada tipo de malware",
        "cards": [
          {
            "id": 1,
            "scenario": "Se propaga autom√°ticamente por la red sin intervenci√≥n humana",
            "correct_answer": "right",
            "labels": {"left": "Virus", "right": "Worm"}
          },
          {
            "id": 2,
            "scenario": "Necesita que el usuario ejecute un archivo infectado",
            "correct_answer": "left",
            "labels": {"left": "Virus", "right": "Worm"}
          },
          {
            "id": 3,
            "scenario": "WannaCry explotando SMB para infectar nuevos hosts",
            "correct_answer": "right",
            "labels": {"left": "Virus", "right": "Worm"}
          },
          {
            "id": 4,
            "scenario": "Macro maliciosa en documento Word enviado por email",
            "correct_answer": "left",
            "labels": {"left": "Virus", "right": "Worm"}
          }
        ],
        "xp_per_correct": 8
      }
    },
    {
      "screen_id": 4,
      "type": "story_slide",
      "title": "WannaCry: Vista General",
      "content": {
        "icon": "schema",
        "icon_color": "#F44336",
        "headline": "Componentes del Ataque",
        "body": "WannaCry combina m√∫ltiples t√©cnicas en un solo paquete devastador:",
        "visual_element": {
          "type": "flow_diagram",
          "nodes": [
            {"id": "1", "label": "EternalBlue", "desc": "Exploit SMB"},
            {"id": "2", "label": "DoublePulsar", "desc": "Backdoor"},
            {"id": "3", "label": "Dropper", "desc": "Instalador"},
            {"id": "4", "label": "Encryptor", "desc": "Cifrado"},
            {"id": "5", "label": "Decryptor UI", "desc": "Nota de rescate"}
          ]
        }
      }
    },
    {
      "screen_id": 5,
      "type": "evidence_lab",
      "title": "üî¨ Laboratorio Forense",
      "content": {
        "instruction": "Arrastra los componentes de WannaCry en el ORDEN CORRECTO de ejecuci√≥n",
        "evidence_items": [
          {"id": "exploit", "name": "EternalBlue Exploit", "icon": "vpn_key", "correct_order": 1},
          {"id": "backdoor", "name": "DoublePulsar Backdoor", "icon": "door_back", "correct_order": 2},
          {"id": "dropper", "name": "Malware Dropper", "icon": "file_download", "correct_order": 3},
          {"id": "killswitch", "name": "Kill Switch Check", "icon": "power_settings_new", "correct_order": 4},
          {"id": "encrypt", "name": "File Encryption", "icon": "lock", "correct_order": 5}
        ],
        "drop_zones": [
          {"order": 1, "label": "Paso 1: Entrada inicial"},
          {"order": 2, "label": "Paso 2: Persistencia"},
          {"order": 3, "label": "Paso 3: Payload delivery"},
          {"order": 4, "label": "Paso 4: Verificaci√≥n"},
          {"order": 5, "label": "Paso 5: Impacto"}
        ],
        "success_message": "¬°Excelente! Entiendes la cadena de ataque de WannaCry",
        "xp_reward": 30
      }
    },
    {
      "screen_id": 6,
      "type": "flip_card_full",
      "title": "Fase 1: EternalBlue",
      "content": {
        "card": {
          "front": {
            "icon": "vpn_key",
            "term": "ETERNALBLUE",
            "subtitle": "MS17-010 Exploit",
            "color": "#D32F2F"
          },
          "back": {
            "definition": "Exploit desarrollado por la NSA, filtrado por Shadow Brokers",
            "technical_details": [
              "Vulnerabilidad: Buffer overflow en SMBv1",
              "Puerto: 445 (Server Message Block)",
              "CVE: CVE-2017-0144",
              "Impacto: Remote Code Execution sin autenticaci√≥n"
            ],
            "why_devastating": "No requiere interacci√≥n del usuario. Solo necesita puerto 445 abierto.",
            "color": "#B71C1C"
          }
        }
      }
    },
    {
      "screen_id": 7,
      "type": "flip_card_full",
      "title": "Fase 2: DoublePulsar",
      "content": {
        "card": {
          "front": {
            "icon": "door_back",
            "term": "DOUBLEPULSAR",
            "subtitle": "Backdoor Implant",
            "color": "#7B1FA2"
          },
          "back": {
            "definition": "Backdoor que se instala en kernel mode despu√©s de EternalBlue",
            "technical_details": [
              "Tipo: Kernel-mode implant",
              "Funci√≥n: Permite ejecuci√≥n de c√≥digo adicional",
              "Detecci√≥n: Dif√≠cil - opera en Ring 0",
              "Persistencia: En memoria, no en disco"
            ],
            "why_important": "Permite cargar cualquier payload sin tocar el disco = evade antivirus tradicional",
            "color": "#6A1B9A"
          }
        }
      }
    },
    {
      "screen_id": 8,
      "type": "story_slide",
      "title": "Fase 3: Cifrado",
      "content": {
        "icon": "enhanced_encryption",
        "icon_color": "#FF9800",
        "headline": "Cifrado H√≠brido",
        "body": "WannaCry usa una combinaci√≥n de algoritmos para m√°xima efectividad:",
        "visual_element": {
          "type": "encryption_flow",
          "steps": [
            {"algo": "AES-128-CBC", "purpose": "Cifra cada archivo (r√°pido)"},
            {"algo": "RSA-2048", "purpose": "Cifra las keys AES (seguro)"},
            {"algo": "Master Key", "purpose": "Solo los atacantes la tienen"}
          ]
        },
        "tech_note": "Sin la master key RSA, es matem√°ticamente imposible descifrar los archivos."
      }
    },
    {
      "screen_id": 9,
      "type": "drag_drop_match",
      "title": "T√©cnicas de Evasi√≥n",
      "content": {
        "instruction": "Arrastra cada t√©cnica de malware a su prop√≥sito",
        "scenarios": [
          {"id": 1, "text": "Operar solo en memoria RAM", "correct_target": "evasion"},
          {"id": 2, "text": "Verificar si est√° en sandbox/VM", "correct_target": "evasion"},
          {"id": 3, "text": "Cifrar archivos del usuario", "correct_target": "impact"},
          {"id": 4, "text": "Escanear red local buscando puerto 445", "correct_target": "propagation"},
          {"id": 5, "text": "Mostrar nota de rescate", "correct_target": "impact"},
          {"id": 6, "text": "Inyectarse en procesos leg√≠timos", "correct_target": "evasion"}
        ],
        "targets": [
          {"id": "evasion", "label": "Defense Evasion", "color": "#9C27B0", "icon": "visibility_off"},
          {"id": "propagation", "label": "Propagaci√≥n", "color": "#2196F3", "icon": "share"},
          {"id": "impact", "label": "Impacto Final", "color": "#F44336", "icon": "warning"}
        ],
        "xp_per_correct": 6
      }
    },
    {
      "screen_id": 10,
      "type": "log_hunter",
      "title": "üîç Indicadores de Compromiso",
      "content": {
        "instruction": "Identifica los IOCs (Indicators of Compromise) de WannaCry",
        "logs": [
          {"id": 1, "timestamp": "Hash", "text": "File: tasksche.exe - SHA256: 24d004...normal system file", "suspicious": false},
          {"id": 2, "timestamp": "Hash", "text": "File: mssecsvc.exe - SHA256: ed01eb...known WannaCry", "suspicious": true},
          {"id": 3, "timestamp": "Network", "text": "DNS query: google.com", "suspicious": false},
          {"id": 4, "timestamp": "Network", "text": "DNS query: iuqerfsodp9ifjaposdfjhgosurijfaewrwergwea.com", "suspicious": true},
          {"id": 5, "timestamp": "File", "text": "Extension changed: report.docx ‚Üí report.docx.WNCRY", "suspicious": true},
          {"id": 6, "timestamp": "Process", "text": "svchost.exe spawned by services.exe", "suspicious": false},
          {"id": 7, "timestamp": "Network", "text": "Outbound SMB scan to 10.0.0.0/8 on port 445", "suspicious": true}
        ],
        "hints": [
          "El dominio largo es el kill switch de WannaCry",
          ".WNCRY es la extensi√≥n de archivos cifrados",
          "Escaneo SMB masivo indica propagaci√≥n de worm"
        ],
        "success_threshold": 4,
        "xp_reward": 25
      }
    },
    {
      "screen_id": 11,
      "type": "flip_card_full",
      "title": "C2: Command & Control",
      "content": {
        "card": {
          "front": {
            "icon": "cell_tower",
            "term": "C2 / C&C",
            "subtitle": "Command and Control",
            "color": "#00796B"
          },
          "back": {
            "definition": "Infraestructura que permite al atacante comunicarse con el malware",
            "common_methods": [
              "HTTP/HTTPS - Parece tr√°fico web normal",
              "DNS tunneling - Oculto en queries DNS",
              "Social media - Comandos en posts/im√°genes",
              "P2P - Sin servidor central"
            ],
            "wannacry_note": "WannaCry ten√≠a C2 deficiente. Los atacantes no pod√≠an verificar pagos individuales = muchos que pagaron no recuperaron archivos.",
            "color": "#00695C"
          }
        }
      }
    },
    {
      "screen_id": 12,
      "type": "crisis_decision",
      "title": "üö® RANSOMWARE DETECTADO",
      "content": {
        "scenario": "Tu sistema de monitoreo detecta extensiones .WNCRY apareciendo en file servers. Ya hay 500 archivos cifrados y el n√∫mero crece. ¬øQu√© haces PRIMERO?",
        "timer_seconds": 20,
        "alert_type": "critical",
        "options": [
          {
            "id": "isolate",
            "text": "Desconectar sistemas afectados de la red",
            "icon": "wifi_off",
            "is_correct": true,
            "consequence": {
              "title": "Contenci√≥n Correcta",
              "description": "Aislar detiene la propagaci√≥n. Los archivos ya cifrados se pierden, pero salvas el resto de la red.",
              "impact_score": 100
            }
          },
          {
            "id": "backup",
            "text": "Iniciar backup de emergencia",
            "icon": "backup",
            "is_correct": false,
            "consequence": {
              "title": "Demasiado Tarde",
              "description": "El ransomware cifrar√° m√°s archivos mientras haces backup. Adem√°s, podr√≠as copiar el malware al backup.",
              "impact_score": -40
            }
          },
          {
            "id": "antivirus",
            "text": "Ejecutar scan de antivirus completo",
            "icon": "security",
            "is_correct": false,
            "consequence": {
              "title": "Muy Lento",
              "description": "Un scan completo toma horas. En ese tiempo, el ransomware habr√° cifrado toda la red.",
              "impact_score": -60
            }
          }
        ]
      }
    },
    {
      "screen_id": 13,
      "type": "swipe_cards",
      "title": "¬øPagar el Rescate?",
      "content": {
        "instruction": "¬øDeber√≠as pagar el rescate en estos escenarios?",
        "cards": [
          {
            "id": 1,
            "scenario": "Tienes backups offline verificados de hace 24 horas",
            "correct_answer": "left",
            "labels": {"left": "NO Pagar", "right": "Pagar"}
          },
          {
            "id": 2,
            "scenario": "Hospital sin backups, pacientes en riesgo, no hay tiempo",
            "correct_answer": "right",
            "labels": {"left": "NO Pagar", "right": "Considerar pagar"}
          },
          {
            "id": 3,
            "scenario": "El grupo de ransomware tiene historial de no dar keys",
            "correct_answer": "left",
            "labels": {"left": "NO Pagar", "right": "Pagar"}
          },
          {
            "id": 4,
            "scenario": "Datos irrecuperables, sin backup, empresa cierra si no recupera",
            "correct_answer": "right",
            "labels": {"left": "NO Pagar", "right": "Considerar pagar"}
          }
        ],
        "disclaimer": "El FBI recomienda NO pagar. Pero cada situaci√≥n es √∫nica. Pagar financia m√°s ataques.",
        "xp_per_correct": 10
      }
    },
    {
      "screen_id": 14,
      "type": "story_slide",
      "title": "Defensa en Profundidad",
      "content": {
        "icon": "shield",
        "icon_color": "#4CAF50",
        "headline": "Capas de Protecci√≥n",
        "body": "No existe una soluci√≥n m√°gica contra ransomware. Necesitas m√∫ltiples capas:",
        "defense_layers": [
          {"layer": "Per√≠metro", "controls": "Firewall, IPS, email gateway"},
          {"layer": "Red", "controls": "Segmentaci√≥n, monitoreo SMB"},
          {"layer": "Endpoint", "controls": "EDR, antivirus, application whitelisting"},
          {"layer": "Datos", "controls": "Backups offline, cifrado, DLP"},
          {"layer": "Usuario", "controls": "Awareness, phishing training, MFA"}
        ]
      }
    },
    {
      "screen_id": 15,
      "type": "slider_balance",
      "title": "Estrategia de Backup",
      "content": {
        "scenario": "Dise√±as la pol√≠tica de backups ante la amenaza de Ransomware. ¬øQu√© estrategia implementas?",
        "left_option": {
          "label": "C√≥modo (Online/Cloud)",
          "icon": "cloud_sync",
          "consequences": [
            "‚úÖ R√°pido y autom√°tico",
            "‚ùå Si est√°s infectado, el backup tambi√©n se cifra",
            "‚ùå Punto √∫nico de fallo"
          ]
        },
        "right_option": {
          "label": "Blindado (Regla 3-2-1)",
          "icon": "cloud_off",
          "consequences": [
            "‚úÖ 3 copias, 2 medios, 1 OFFLINE (Air-gapped)",
            "‚úÖ El ransomware NO puede tocar el disco desconectado",
            "‚úÖ Recuperaci√≥n garantizada"
          ]
        },
        "explanation": "La regla 3-2-1 es innegociable contra ransomware. Si tu backup es accesible desde la red infectada, no tienes un backup, tienes archivos cifrados esperando a pasar."
      }
    },
    {
      "screen_id": 16,
      "type": "timed_quiz",
      "title": "‚ö° Speed Round",
      "content": {
        "timer_seconds": 15,
        "question": "WannaCry se propaga autom√°ticamente por la red sin intervenci√≥n del usuario. ¬øQu√© tipo de malware es?",
        "options": [
          {"id": "a", "text": "Virus", "is_correct": false},
          {"id": "b", "text": "Trojan", "is_correct": false},
          {"id": "c", "text": "Worm", "is_correct": true},
          {"id": "d", "text": "Spyware", "is_correct": false}
        ],
        "explanation": "WannaCry es un WORM porque se auto-propaga explotando SMB sin necesidad de que el usuario haga nada. Los virus necesitan un archivo host y acci√≥n del usuario.",
        "xp_reward": 15
      }
    },
    {
      "screen_id": 17,
      "type": "summary_stats",
      "title": "Anatom√≠a Completa",
      "content": {
        "stats": [
          {"icon": "vpn_key", "value": "EternalBlue", "label": "Exploit de entrada"},
          {"icon": "door_back", "value": "DoublePulsar", "label": "Backdoor"},
          {"icon": "enhanced_encryption", "value": "RSA+AES", "label": "Cifrado h√≠brido"},
          {"icon": "cell_tower", "value": "Deficiente", "label": "Infraestructura C2"}
        ],
        "key_insight": "WannaCry fue devastador en propagaci√≥n pero amateur en monetizaci√≥n. La defensa clave: patch management + backups offline.",
        "lessons": [
          "Los worms se propagan solos - la velocidad de respuesta es cr√≠tica",
          "Cifrado h√≠brido (RSA+AES) es pr√°cticamente irrompible",
          "Backups offline son tu √∫ltima l√≠nea de defensa",
          "Segmentaci√≥n de red limita el radio de explosi√≥n"
        ]
      }
    },
    {
      "screen_id": 18,
      "type": "achievement_unlock",
      "title": "Logro Desbloqueado",
      "content": {
        "achievement": {
          "icon": "biotech",
          "name": "Malware Analyst",
          "description": "Diseccionaste WannaCry componente por componente",
          "rarity": "rare",
          "color": "#9C27B0"
        }
      }
    },
    {
      "screen_id": 19,
      "type": "lesson_complete",
      "title": "Lecci√≥n Completada",
      "content": {
        "xp_earned": 60,
        "key_takeaways": [
          "Worms se auto-propagan, virus necesitan acci√≥n del usuario",
          "WannaCry: EternalBlue ‚Üí DoublePulsar ‚Üí Encryptor",
          "Cifrado h√≠brido RSA+AES es irrompible sin la key",
          "Regla 3-2-1 de backups protege contra ransomware"
        ],
        "next_lesson": {
          "id": "c1_l5",
          "title": "Ingenier√≠a Social",
          "preview": "Equifax: C√≥mo el factor humano caus√≥ el breach de 147 millones"
        }
      }
    }
  ]
}