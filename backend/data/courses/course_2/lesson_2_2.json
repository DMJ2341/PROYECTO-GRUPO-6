{
  "id": "c2_l2",
  "title": "Firewalls y Segmentaci√≥n",
  "description": "Caso Real: Capital One Breach (2019)",
  "type": "interactive",
  "duration_minutes": 22,
  "xp_reward": 55,
  "order_index": 2,
  "course_id": 2,
  "total_screens": 18,
  "theme": {
    "primary_color": "#00BCD4",
    "secondary_color": "#F44336",
    "accent_color": "#FFC107",
    "gradient": ["#0f2027", "#203a43", "#2c5364"]
  },
  "screens": [
    {
      "screen_id": 1,
      "type": "story_intro",
      "title": "Operaci√≥n: Capital One Cloud Breach",
      "content": {
        "headline": "MARZO 2019",
        "subheadline": "WAF misconfiguration + SSRF = 100M records robados",
        "background_image": "cloud_breach",
        "stats": [
          {"value": "100M", "label": "Records expuestos"},
          {"value": "$270M", "label": "Multas y settlements"},
          {"value": "SSRF", "label": "Vector de ataque"}
        ],
        "cta_text": "Investigar Cloud Breach"
      }
    },
    {
      "screen_id": 2,
      "type": "story_slide",
      "title": "Cloud Security Misconception",
      "content": {
        "icon": "cloud",
        "icon_color": "#00BCD4",
        "headline": "AWS Es Seguro... Si T√ö lo Configuras Bien",
        "body": "Capital One migr√≥ a AWS cloud-first. 100M+ aplicaciones de cr√©dito, SSNs, credit scores en S3. Creyeron que AWS = autom√°ticamente seguro.",
        "highlight_box": {
          "type": "warning",
          "text": "Shared Responsibility Model: AWS secure la INFRAESTRUCTURA. T√ö secure la CONFIGURACI√ìN. Capital One fall√≥ en su parte."
        }
      }
    },
    {
      "screen_id": 3,
      "type": "crisis_timeline",
      "title": "‚è±Ô∏è CRONOLOG√çA DEL BREACH",
      "content": {
        "events": [
          {
            "time": "Mar 2019",
            "icon": "bug_report",
            "title": "SSRF Exploit",
            "description": "Paige Thompson (ex-AWS employee) descubre SSRF en WAF de Capital One. WAF ten√≠a IAM role con permisos excesivos.",
            "severity": "critical"
          },
          {
            "time": "22 Mar",
            "icon": "vpn_key",
            "title": "Credential Theft",
            "description": "SSRF ‚Üí metadata endpoint ‚Üí steal IAM credentials. Credentials ten√≠an S3 full access.",
            "severity": "critical"
          },
          {
            "time": "Mar-Jul",
            "icon": "cloud_download",
            "title": "Exfiltraci√≥n Masiva",
            "description": "Thompson descarga 30GB de data (100M+ records) desde 700+ S3 buckets. SSNs, scores, historiales.",
            "severity": "critical"
          },
          {
            "time": "Jun 2019",
            "icon": "code",
            "title": "GitHub Upload",
            "description": "Thompson sube samples a GitHub. Menciona 'Capital One' en commits. Rookie mistake.",
            "severity": "high"
          },
          {
            "time": "17 Jul",
            "icon": "report",
            "title": "Tip An√≥nimo",
            "description": "Alguien reporta el GitHub repo a Capital One. Investigan y descubren el breach.",
            "severity": "high"
          },
          {
            "time": "29 Jul",
            "icon": "gavel",
            "title": "Arresto FBI",
            "description": "FBI arresta Thompson. Capital One anuncia breach p√∫blicamente. PR disaster.",
            "severity": "critical"
          }
        ]
      }
    },
    {
      "screen_id": 4,
      "type": "crisis_decision",
      "title": "üö® DECISI√ìN: IAM Permissions",
      "content": {
        "scenario": "Eres cloud architect en Capital One. Configurando IAM role para WAF. Ingeniero pide: 'Dame S3 full access para simplificar, solo necesito list/read de algunos buckets'. ¬øQu√© haces?",
        "timer_seconds": 25,
        "options": [
          {
            "id": "least_privilege",
            "text": "Solo permisos espec√≠ficos necesarios (list/read buckets espec√≠ficos)",
            "icon": "security",
            "is_correct": true,
            "consequence": {
              "title": "Least Privilege Correcto",
              "description": "Limitas blast radius. Si WAF es compromised, atacante solo accede buckets autorizados. Capital One breach hubiera sido limitado.",
              "impact_score": 100,
              "xp_bonus": 20
            }
          },
          {
            "id": "full_access",
            "text": "S3 full access - m√°s f√°cil, 'confiamos en el WAF'",
            "icon": "all_inclusive",
            "is_correct": false,
            "consequence": {
              "title": "Esto hizo Capital One",
              "description": "WAF con S3 full access. SSRF exploit ‚Üí credentials stolen ‚Üí ALL S3 buckets downloaded. Over-privileged IAM = $270M en multas.",
              "impact_score": -100
            }
          }
        ]
      }
    },
    {
      "screen_id": 5,
      "type": "flip_card_full",
      "title": "Firewall Gen 1: Packet Filtering",
      "content": {
        "card": {
          "front": {
            "icon": "filter_alt",
            "term": "STATELESS FIREWALL",
            "subtitle": "Generaci√≥n 1 - Legacy",
            "color": "#757575"
          },
          "back": {
            "definition": "Inspecciona cada packet individualmente. Rules basadas en: source/dest IP, port, protocol. NO mantiene state de conexiones.",
            "how_it_works": "ACL (Access Control List) en routers. Permite TCP port 80 from any to web server.",
            "vulnerabilities": [
              "No sabe si packet es parte de conexi√≥n leg√≠tima",
              "IP spoofing f√°cil",
              "No puede detectar ataques multi-packet",
              "Muchas rules para manejar bidirectional traffic"
            ],
            "verdict": "OBSOLETO para security moderna",
            "color": "#9E9E9E"
          }
        }
      }
    },
    {
      "screen_id": 6,
      "type": "flip_card_full",
      "title": "Firewall Gen 2: Stateful Inspection",
      "content": {
        "card": {
          "front": {
            "icon": "memory",
            "term": "STATEFUL FIREWALL",
            "subtitle": "Generaci√≥n 2",
            "color": "#1976D2"
          },
          "back": {
            "definition": "Mantiene state table de conexiones activas. Verifica que packets sean parte de conexi√≥n leg√≠tima establecida.",
            "how_it_works": "Permite outbound connection, autom√°ticamente permite response. Blocks unsolicited inbound.",
            "advantages": [
              "Tracking de TCP 3-way handshake",
              "Automatic bidirectional rules",
              "Previene spoofed packets de conexiones inexistentes",
              "Menos rules necesarias"
            ],
            "limitations": "NO inspecciona payload (application layer). Malware en HTTP download pasa.",
            "examples": "Cisco ASA, pfSense, iptables",
            "color": "#1565C0"
          }
        }
      }
    },
    {
      "screen_id": 7,
      "type": "flip_card_full",
      "title": "Firewall Gen 3: Next-Gen (NGFW)",
      "content": {
        "card": {
          "front": {
            "icon": "shield",
            "term": "NGFW",
            "subtitle": "Next-Generation Firewall",
            "color": "#388E3C"
          },
          "back": {
            "definition": "Deep Packet Inspection (DPI) + Application awareness + IPS + Malware detection + SSL inspection.",
            "capabilities": [
              "Application control (block Facebook, allow Gmail)",
              "IPS integrado (detect/prevent exploits)",
              "Malware detection en tr√°fico",
              "SSL/TLS decrypt & inspect",
              "Identity-aware policies (user-based, not just IP)",
              "Threat intelligence integration"
            ],
            "use_cases": "Detecta malware en download leg√≠timo. Blocks C2 communication. User-based rules.",
            "vendors": "Palo Alto, Fortinet, Check Point",
            "color": "#2E7D32"
          }
        }
      }
    },
    {
      "screen_id": 8,
      "type": "flip_card_full",
      "title": "Web Application Firewall (WAF)",
      "content": {
        "card": {
          "front": {
            "icon": "cloud",
            "term": "WAF",
            "subtitle": "Layer 7 Specialist",
            "color": "#F57C00"
          },
          "back": {
            "definition": "Especializado en proteger web applications. Opera en Layer 7 (HTTP/HTTPS). Protege contra OWASP Top 10.",
            "protections": [
              "SQL Injection (SQLi)",
              "Cross-Site Scripting (XSS)",
              "CSRF (Cross-Site Request Forgery)",
              "SSRF (Server-Side Request Forgery)",
              "File inclusion attacks",
              "DDoS protection (rate limiting)"
            ],
            "capital_one_failure": "WAF estaba misconfigured: IAM role con S3 full access. SSRF no bloqueado adecuadamente.",
            "vendors": "Cloudflare, AWS WAF, ModSecurity",
            "best_practice": "WAF con least privilege IAM. Rules basadas en OWASP. Regular updates.",
            "color": "#EF6C00"
          }
        }
      }
    },
    {
      "screen_id": 9,
      "type": "drag_drop_match",
      "title": "Match: Firewall Type ‚Üí Use Case",
      "content": {
        "instruction": "Arrastra cada escenario al tipo de firewall apropiado",
        "scenarios": [
          {"id": 1, "text": "Bloquear SQLi y XSS en web app", "correct_target": "waf"},
          {"id": 2, "text": "Detectar malware en HTTP download", "correct_target": "ngfw"},
          {"id": 3, "text": "Permitir outbound, auto-allow responses", "correct_target": "stateful"},
          {"id": 4, "text": "Block por source IP solamente", "correct_target": "stateless"},
          {"id": 5, "text": "User-based policies (Alice puede, Bob no)", "correct_target": "ngfw"},
          {"id": 6, "text": "Rate limiting contra DDoS HTTP", "correct_target": "waf"}
        ],
        "targets": [
          {"id": "stateless", "label": "Stateless", "color": "#757575"},
          {"id": "stateful", "label": "Stateful", "color": "#1976D2"},
          {"id": "ngfw", "label": "NGFW", "color": "#388E3C"},
          {"id": "waf", "label": "WAF", "color": "#F57C00"}
        ],
        "xp_per_correct": 6
      }
    },
    {
      "screen_id": 10,
      "type": "flip_card_full",
      "title": "Firewall Best Practice: Default Deny",
      "content": {
        "card": {
          "front": {
            "icon": "block",
            "term": "DEFAULT DENY",
            "subtitle": "Principio fundamental",
            "color": "#D32F2F"
          },
          "back": {
            "definition": "Block everything by default. Explicitly allow SOLO lo necesario. Implicit deny al final de ruleset.",
            "rationale": "Reduce attack surface. Si olvidas agregar rule, default es SEGURO (deny), no inseguro (allow).",
            "implementation": [
              "√öltima rule: DENY ALL ALL",
              "Allow rules espec√≠ficas antes",
              "Review trimestral, remove obsoletas",
              "Document justification de cada allow"
            ],
            "capital_one_failure": "WAF permiti√≥ demasiado tr√°fico. IAM role con permisos excesivos = violaci√≥n de default deny.",
            "opposite_mistake": "Default allow = permit any any = no firewall = disaster",
            "color": "#B71C1C"
          }
        }
      }
    },
    {
      "screen_id": 11,
      "type": "flip_card_full",
      "title": "Network Segmentation: DMZ",
      "content": {
        "card": {
          "front": {
            "icon": "widgets",
            "term": "DMZ",
            "subtitle": "Demilitarized Zone",
            "color": "#FF6F00"
          },
          "back": {
            "definition": "Zona intermedia entre internet y internal network. Public-facing services (web, email, DNS) viven aqu√≠.",
            "architecture": "Firewall 1: Internet ‚Üî DMZ. Firewall 2: DMZ ‚Üî Internal.",
            "benefit": "Si DMZ es compromised, internal network SIGUE protegido por firewall 2.",
            "example": "Web server en DMZ. Database server internal. Hacker compromete web ‚Üí NO puede acceder database directamente.",
            "modern_equivalent": "Cloud: Public subnet (DMZ) + Private subnet (internal) con security groups",
            "color": "#F57C00"
          }
        }
      }
    },
    {
      "screen_id": 12,
      "type": "flip_card_full",
      "title": "Network Segmentation: VLANs",
      "content": {
        "card": {
          "front": {
            "icon": "lan",
            "term": "VLAN",
            "subtitle": "Virtual LAN",
            "color": "#1976D2"
          },
          "back": {
            "definition": "Segmentaci√≥n L√ìGICA de network. Devices en VLANs diferentes no pueden comunicarse sin router/firewall.",
            "use_cases": [
              "VLAN 10: Guest WiFi",
              "VLAN 20: Employees",
              "VLAN 30: Servers",
              "VLAN 40: IoT devices"
            ],
            "benefit": "Isolation sin separaci√≥n f√≠sica. Guest no puede reach servers. IoT no puede reach employee PCs.",
            "mirai_lesson": "Flat networks (sin VLANs) permitieron propagaci√≥n de Mirai. VLANs hubieran limitado.",
            "implementation": "802.1Q tagging. Managed switches.",
            "color": "#1565C0"
          }
        }
      }
    },
    {
      "screen_id": 13,
      "type": "swipe_cards",
      "title": "Firewall Rule: Segura o Insegura?",
      "content": {
        "instruction": "¬øEsta firewall rule es segura?",
        "cards": [
          {
            "id": 1,
            "scenario": "ALLOW ANY ANY from 0.0.0.0/0 to 0.0.0.0/0",
            "correct_answer": "left",
            "labels": {"left": "‚ùå INSEGURA", "right": "‚úÖ SEGURA"}
          },
          {
            "id": 2,
            "scenario": "ALLOW TCP port 443 from 0.0.0.0/0 to web_server_IP",
            "correct_answer": "right",
            "labels": {"left": "‚ùå INSEGURA", "right": "‚úÖ SEGURA"}
          },
          {
            "id": 3,
            "scenario": "ALLOW TCP port 3389 (RDP) from 0.0.0.0/0 to internal_servers",
            "correct_answer": "left",
            "labels": {"left": "‚ùå INSEGURA", "right": "‚úÖ SEGURA"}
          },
          {
            "id": 4,
            "scenario": "DENY ALL ALL (como √∫ltima rule)",
            "correct_answer": "right",
            "labels": {"left": "‚ùå INSEGURA", "right": "‚úÖ SEGURA"}
          },
          {
            "id": 5,
            "scenario": "ALLOW TCP port 22 (SSH) from VPN_IP_range to admin_servers",
            "correct_answer": "right",
            "labels": {"left": "‚ùå INSEGURA", "right": "‚úÖ SEGURA"}
          }
        ],
        "xp_per_correct": 8
      }
    },
    {
      "screen_id": 14,
      "type": "slider_balance",
      "title": "Firewall Logging Level",
      "content": {
        "scenario": "Configura nivel de logging para firewall. M√°s logging = m√°s visibilidad pero m√°s storage/processing.",
        "left_option": {
          "label": "B√°sico (Denies Only)",
          "icon": "visibility_off",
          "consequences": [
            "‚úÖ Ahorra espacio de almacenamiento",
            "‚ùå Ciego ante ataques en tr√°fico permitido",
            "‚ùå Imposible correlacionar eventos complejos"
          ]
        },
        "right_option": {
          "label": "Completo (All Traffic)",
          "icon": "visibility",
          "consequences": [
            "‚úÖ Visibilidad total para Threat Hunting",
            "‚úÖ Permite detectar anomal√≠as en tr√°fico permitido",
            "‚ùå Alto consumo de disco y CPU"
          ]
        },
        "explanation": "El est√°ndar moderno es loggear TODO (Metadata: Source, Dest, Port, Action). El almacenamiento es barato; la ceguera ante un ataque es car√≠sima."
      }
    },
    {
      "screen_id": 15,
      "type": "timed_quiz",
      "title": "‚ö° Capital One Error",
      "content": {
        "timer_seconds": 25,
        "question": "¬øCu√°l fue el error fundamental de Capital One?",
        "options": [
          {"id": "a", "text": "No ten√≠an firewall", "is_correct": false},
          {"id": "b", "text": "WAF con IAM role over-privileged + SSRF no bloqueado", "is_correct": true},
          {"id": "c", "text": "Usaron stateless firewall", "is_correct": false},
          {"id": "d", "text": "No usaron NGFW", "is_correct": false}
        ],
        "explanation": "Capital One ten√≠a WAF. Problema: 1) IAM role con S3 FULL ACCESS (violaci√≥n least privilege). 2) SSRF vulnerability no mitigada. SSRF ‚Üí metadata endpoint ‚Üí steal credentials ‚Üí download ALL S3. Dos errores combinados = $270M p√©rdidas.",
        "xp_reward": 20
      }
    },
    {
      "screen_id": 16,
      "type": "summary_stats",
      "title": "Capital One: Lecciones",
      "content": {
        "stats": [
          {"icon": "cloud", "value": "100M", "label": "Records expuestos"},
          {"icon": "attach_money", "value": "$270M", "label": "Multas totales"},
          {"icon": "vpn_key", "value": "S3 Full", "label": "IAM permissions (error)"},
          {"icon": "schedule", "value": "4 meses", "label": "Dwell time"}
        ],
        "root_causes": [
          "WAF IAM role con S3 full access (over-privileged)",
          "SSRF vulnerability no mitigada en WAF",
          "Sin detection de metadata endpoint access",
          "Sin DLP para large S3 downloads"
        ],
        "lessons": [
          "Cloud Shared Responsibility: AWS secure infra, T√ö secure config",
          "Least Privilege en IAM es CR√çTICO",
          "WAF debe proteger contra SSRF",
          "Logging + monitoring de metadata endpoint access"
        ]
      }
    },
    {
      "screen_id": 17,
      "type": "achievement_unlock",
      "title": "Logro Desbloqueado",
      "content": {
        "achievement": {
          "icon": "shield",
          "name": "Firewall Architect",
          "description": "Dominas tipos de firewalls, segmentaci√≥n y best practices",
          "rarity": "rare",
          "color": "#00BCD4"
        }
      }
    },
    {
      "screen_id": 18,
      "type": "lesson_complete",
      "title": "Lecci√≥n Completada",
      "content": {
        "xp_earned": 55,
        "key_takeaways": [
          "4 tipos: Stateless ‚Üí Stateful ‚Üí NGFW ‚Üí WAF (especializado)",
          "Default Deny: block todo, allow espec√≠fico",
          "Least Privilege en permisos (IAM, firewall rules)",
          "Segmentation: DMZ + VLANs limitan blast radius",
          "Capital One: WAF misconfigured + SSRF = $270M p√©rdidas"
        ],
        "next_lesson": {
          "id": "c2_l3",
          "title": "IDS/IPS y Detection",
          "preview": "Heartbleed: c√≥mo detectar y prevenir exploits en tiempo real"
        }
      }
    }
  ]
}