{
  "id": "c2_l3",
  "title": "IDS/IPS",
  "description": "Caso Real: Heartbleed (2014)",
  "type": "interactive",
  "duration_minutes": 18,
  "xp_reward": 50,
  "order_index": 3,
  "course_id": 2,
  "total_screens": 15,
  "theme": {
    "primary_color": "#E91E63",
    "secondary_color": "#9C27B0",
    "accent_color": "#00BCD4",
    "gradient": ["#1a1a2e", "#2d1b2e", "#4a1942"]
  },
  "screens": [
    {
      "screen_id": 1,
      "type": "story_intro",
      "title": "Operaci√≥n: Heartbleed",
      "content": {
        "headline": "7 ABRIL 2014",
        "subheadline": "Buffer over-read en OpenSSL expone 17% de internet",
        "stats": [
          {"value": "CVE-2014-0160", "label": "Vulnerability ID"},
          {"value": "500K", "label": "Sites vulnerables"},
          {"value": "2 a√±os", "label": "Bug existi√≥ sin detectar"}
        ],
        "cta_text": "Investigar el Bug"
      }
    },
    {
      "screen_id": 2,
      "type": "story_slide",
      "title": "El Bug M√°s Peligroso",
      "content": {
        "icon": "favorite_border",
        "icon_color": "#E91E63",
        "headline": "Buffer Over-Read en TLS Heartbeat",
        "body": "OpenSSL implement√≥ TLS heartbeat (keep-alive) sin bounds checking. Atacante pod√≠a pedir 1 byte, server devolv√≠a 64KB de memoria. Passwords, private keys, session tokens... todo leakeado.",
        "highlight_box": {
          "type": "danger",
          "text": "Una l√≠nea de c√≥digo faltante (bounds check) = 500,000 sites vulnerables. Yahoo, Google, AWS afectados."
        }
      }
    },
    {
      "screen_id": 3,
      "type": "flip_card_full",
      "title": "TLS/SSL: Encryption Basics",
      "content": {
        "card": {
          "front": {
            "icon": "lock",
            "term": "TLS/SSL",
            "subtitle": "Transport Layer Security",
            "color": "#1976D2"
          },
          "back": {
            "definition": "Protocolo de encryption para comunicaciones seguras. HTTPS = HTTP + TLS. Encripta data en tr√°nsito.",
            "how_it_works": [
              "1. Handshake: Client y server acuerdan cipher suite",
              "2. Certificate exchange: Server prueba identidad",
              "3. Key exchange: Establecen session keys",
              "4. Encrypted communication: Data cifrada con session keys"
            ],
            "heartbleed_impact": "Heartbeat bug permit√≠a leer memoria server = leak de session keys, private keys, passwords.",
            "color": "#1565C0"
          }
        }
      }
    },
    {
      "screen_id": 4,
      "type": "crisis_decision",
      "title": "üö® Heartbleed Detectado",
      "content": {
        "scenario": "7 de abril 2014, Heartbleed es public. Eres CISO. Tu infra usa OpenSSL vulnerable en TODOS los web servers. ¬øQu√© haces PRIMERO?",
        "timer_seconds": 25,
        "options": [
          {
            "id": "patch_and_rekey",
            "text": "Patch OpenSSL + re-issue TODOS los certificates + revoke old",
            "icon": "security",
            "is_correct": true,
            "consequence": {
              "title": "Respuesta Correcta",
              "description": "Patching solo no es suficiente. Private keys estuvieron exposed. DEBES re-issue certificates. Doloroso pero necesario.",
              "impact_score": 100,
              "xp_bonus": 20
            }
          },
          {
            "id": "just_patch",
            "text": "Solo patchear OpenSSL - keys probablemente no fueron robadas",
            "icon": "update",
            "is_correct": false,
            "consequence": {
              "title": "Insuficiente",
              "description": "No sabes SI keys fueron robadas. Asumir lo peor. Muchas companies solo parchearon = siguieron vulnerables con old keys.",
              "impact_score": -60
            }
          }
        ]
      }
    },
    {
      "screen_id": 5,
      "type": "flip_card_full",
      "title": "IDS: Intrusion Detection System",
      "content": {
        "card": {
          "front": {
            "icon": "visibility",
            "term": "IDS",
            "subtitle": "Detection Only",
            "color": "#FF9800"
          },
          "back": {
            "definition": "Sistema que DETECTA ataques pero NO los bloquea. Genera alertas para que humanos investiguen.",
            "types": [
              "NIDS (Network): Analiza tr√°fico de red",
              "HIDS (Host): Analiza logs y files de un host"
            ],
            "detection_methods": [
              "Signature-based: Busca patterns conocidos (como antivirus)",
              "Anomaly-based: Detecta desviaciones de baseline"
            ],
            "pros": "No bloquea tr√°fico leg√≠timo por error. Puede analizar todo.",
            "cons": "No previene. Reacci√≥n lenta. Falsos positivos.",
            "tools": "Snort (NIDS), OSSEC (HIDS)",
            "color": "#F57C00"
          }
        }
      }
    },
    {
      "screen_id": 6,
      "type": "flip_card_full",
      "title": "IPS: Intrusion Prevention System",
      "content": {
        "card": {
          "front": {
            "icon": "shield",
            "term": "IPS",
            "subtitle": "Detection + Prevention",
            "color": "#388E3C"
          },
          "back": {
            "definition": "IDS + capacidad de BLOQUEAR tr√°fico malicioso en tiempo real. Inline con el tr√°fico.",
            "how_it_works": "Tr√°fico pasa POR el IPS. Si detecta ataque, DROP packet inmediatamente.",
            "detection_methods": [
              "Signature-based: Block exploits conocidos",
              "Protocol analysis: Detecta violations de RFC",
              "Rate limiting: Previene floods"
            ],
            "pros": "Prevenci√≥n autom√°tica. Sin intervenci√≥n humana.",
            "cons": "False positive = block tr√°fico leg√≠timo. Latency adicional.",
            "heartbleed_use": "IPS con signature de Heartbleed hubiera bloqueado exploitation attempts.",
            "tools": "Suricata, Snort (modo IPS), Palo Alto IPS",
            "color": "#2E7D32"
          }
        }
      }
    },
    {
      "screen_id": 7,
      "type": "drag_drop_match",
      "title": "IDS vs IPS: Use Cases",
      "content": {
        "instruction": "¬øCu√°ndo usar IDS o IPS?",
        "scenarios": [
          {"id": 1, "text": "Production cr√≠tico donde false positive = downtime", "correct_target": "ids"},
          {"id": 2, "text": "Bloquear exploits conocidos autom√°ticamente", "correct_target": "ips"},
          {"id": 3, "text": "An√°lisis forense posterior a incidente", "correct_target": "ids"},
          {"id": 4, "text": "Prevenir DDoS floods en tiempo real", "correct_target": "ips"},
          {"id": 5, "text": "Monitoring sin riesgo de bloquear tr√°fico", "correct_target": "ids"}
        ],
        "targets": [
          {"id": "ids", "label": "IDS (Detection)", "color": "#FF9800"},
          {"id": "ips", "label": "IPS (Prevention)", "color": "#388E3C"}
        ],
        "xp_per_correct": 6
      }
    },
    {
      "screen_id": 8,
      "type": "flip_card_full",
      "title": "Signature-Based Detection",
      "content": {
        "card": {
          "front": {
            "icon": "fingerprint",
            "term": "SIGNATURES",
            "subtitle": "Pattern Matching",
            "color": "#2196F3"
          },
          "back": {
            "definition": "Busca patterns espec√≠ficos de ataques conocidos. Como antivirus para red.",
            "how_it_works": "Database de signatures (e.g. SQLi patterns, exploit payloads). Traffic matching signature = alert/block.",
            "pros": [
              "Alta accuracy para ataques conocidos",
              "Bajos false positives",
              "R√°pido (pattern matching)"
            ],
            "cons": [
              "Zero-days NO detectados",
              "Necesita constant updates",
              "Evasion con obfuscation"
            ],
            "heartbleed_example": "Signature: detectar TLS heartbeat request con length field > actual data.",
            "color": "#1976D2"
          }
        }
      }
    },
    {
      "screen_id": 9,
      "type": "flip_card_full",
      "title": "Anomaly-Based Detection",
      "content": {
        "card": {
          "front": {
            "icon": "analytics",
            "term": "ANOMALY",
            "subtitle": "Behavioral Analysis",
            "color": "#9C27B0"
          },
          "back": {
            "definition": "Establece baseline de comportamiento normal. Detecta desviaciones significativas.",
            "how_it_works": [
              "1. Training period: Learn normal traffic patterns",
              "2. Threshold setting: Cu√°nta desviaci√≥n = alert",
              "3. Detection: Flag anomalies en real-time"
            ],
            "pros": "Detecta zero-days. No necesita signatures. Adapta a cambios.",
            "cons": "MUCHOS false positives. Leg√≠timos spikes = alertas. Training period necesario.",
            "use_case": "Detectar exfiltraci√≥n de data inusual. Lateral movement an√≥malo.",
            "color": "#7B1FA2"
          }
        }
      }
    },
    {
      "screen_id": 10,
      "type": "swipe_cards",
      "title": "Signature o Anomaly?",
      "content": {
        "instruction": "¬øEste ataque se detecta mejor con signatures o anomaly?",
        "cards": [
          {
            "id": 1,
            "scenario": "SQLi conocido: ' OR 1=1--",
            "correct_answer": "left",
            "labels": {"left": "Signature", "right": "Anomaly"}
          },
          {
            "id": 2,
            "scenario": "Usuario descarga 10GB de data (normal: 10MB/d√≠a)",
            "correct_answer": "right",
            "labels": {"left": "Signature", "right": "Anomaly"}
          },
          {
            "id": 3,
            "scenario": "Heartbleed exploit con pattern espec√≠fico",
            "correct_answer": "left",
            "labels": {"left": "Signature", "right": "Anomaly"}
          },
          {
            "id": 4,
            "scenario": "Zero-day exploit nunca visto",
            "correct_answer": "right",
            "labels": {"left": "Signature", "right": "Anomaly"}
          }
        ],
        "xp_per_correct": 8
      }
    },
    {
      "screen_id": 11,
      "type": "log_hunter",
      "title": "üîç Detect Heartbleed Exploit",
      "content": {
        "instruction": "Analiza IDS logs. Identifica intentos de Heartbleed exploitation.",
        "logs": [
          {"id": 1, "text": "TLS Handshake: ClientHello from 192.168.1.100", "suspicious": false},
          {"id": 2, "text": "TLS Heartbeat Request: length=65535 actual_data=1 from 185.x.x.x", "suspicious": true},
          {"id": 3, "text": "HTTP GET /index.html from 192.168.1.200", "suspicious": false},
          {"id": 4, "text": "TLS Heartbeat Request: length=16384 actual_data=16 from 185.x.x.x", "suspicious": true},
          {"id": 5, "text": "TLS Heartbeat Response: 64KB sent to 185.x.x.x", "suspicious": true},
          {"id": 6, "text": "HTTPS POST /login from 192.168.1.150", "suspicious": false}
        ],
        "hints": [
          "Heartbleed: length field >> actual data",
          "Mismo atacante (185.x.x.x) multiple requests",
          "Server enviando 64KB = leaking memory"
        ],
        "success_threshold": 3,
        "xp_reward": 20
      }
    },
    {
      "screen_id": 12,
      "type": "flip_card_full",
      "title": "False Positives vs False Negatives",
      "content": {
        "card": {
          "front": {
            "icon": "balance",
            "term": "TUNING",
            "subtitle": "El balance cr√≠tico",
            "color": "#FF5722"
          },
          "back": {
            "definition": "False Positive: Alerta de ataque cuando es tr√°fico leg√≠timo. False Negative: NO detectar ataque real.",
            "trade_off": {
              "high_sensitivity": "Muchos FP. Alert fatigue. Analistas ignoran.",
              "low_sensitivity": "Muchos FN. Ataques reales pasan sin detectar."
            },
            "tuning_needed": "Ajustar thresholds basado en: Baseline de tr√°fico, Criticidad de assets, Tolerance a false positives",
            "best_practice": "Start conservative (high sensitivity), tune down basado en FP rate. Revisar FN en incident reviews.",
            "color": "#E64A19"
          }
        }
      }
    },
    {
      "screen_id": 13,
      "type": "timed_quiz",
      "title": "‚ö° IDS/IPS Decision",
      "content": {
        "timer_seconds": 20,
        "question": "Tienes production cr√≠tico donde 1 minuto de downtime = $100K p√©rdidas. ¬øQu√© deployment?",
        "options": [
          {"id": "a", "text": "IPS inline con auto-blocking", "is_correct": false},
          {"id": "b", "text": "IDS en monitoring mode + manual response", "is_correct": true},
          {"id": "c", "text": "No usar IDS/IPS - muy riesgoso", "is_correct": false}
        ],
        "explanation": "IPS inline puede causar downtime con false positive. Para production cr√≠tico, usar IDS (monitoring) con SOC 24/7 para manual response. Balance entre security y availability.",
        "xp_reward": 15
      }
    },
    {
      "screen_id": 14,
      "type": "achievement_unlock",
      "title": "Logro Desbloqueado",
      "content": {
        "achievement": {
          "icon": "visibility",
          "name": "Threat Detection Master",
          "description": "Dominas IDS/IPS, signatures, y anomaly detection",
          "rarity": "rare",
          "color": "#E91E63"
        }
      }
    },
    {
      "screen_id": 15,
      "type": "lesson_complete",
      "title": "Lecci√≥n Completada",
      "content": {
        "xp_earned": 50,
        "key_takeaways": [
          "IDS = Detection only. IPS = Detection + Prevention",
          "Signature-based: Ataques conocidos. Anomaly-based: Zero-days",
          "Heartbleed: Buffer over-read en OpenSSL por 2 a√±os",
          "False Positives vs False Negatives: Tuning es cr√≠tico",
          "Production cr√≠tico ‚Üí IDS. Auto-prevention ‚Üí IPS"
        ],
        "next_lesson": {
          "id": "c2_l4",
          "title": "VPN y T√∫neles Seguros",
          "preview": "NotPetya: cuando VPN sin segmentaci√≥n destruye empresas"
        }
      }
    }
  ]
}