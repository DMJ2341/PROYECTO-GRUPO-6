{
  "id": "c4_l5",
  "title": "Seguridad API",
  "description": "Caso Real: T-Mobile API Breach (2021-2023)",
  "type": "interactive",
  "duration_minutes": 26,
  "xp_reward": 65,
  "order_index": 5,
  "course_id": 4,
  "total_screens": 19,
  "theme": {
    "primary_color": "#9C27B0",
    "secondary_color": "#FF4081",
    "accent_color": "#00BCD4",
    "gradient": ["#1a001a", "#330033", "#4d004d"]
  },
  "screens": [
    {
      "screen_id": 1,
      "type": "story_intro",
      "title": "Operaci√≥n: API Leaks",
      "content": {
        "headline": "2021-2023",
        "subheadline": "T-Mobile sufre 7 breaches v√≠a APIs sin autenticar ‚Üí 100M+ registros expuestos",
        "stats": [
          {"value": "100M+", "label": "Clientes afectados"},
          {"value": "7", "label": "Breaches distintos"},
          {"value": "$350M", "label": "Settlement total"}
        ],
        "cta_text": "Investigar API Abuse"
      }
    },
    {
      "screen_id": 2,
      "type": "story_slide",
      "title": "API sin autenticaci√≥n = Internet p√∫blica",
      "content": {
        "icon": "api",
        "icon_color": "#FF4081",
        "headline": "T-Mobile API Gateway expuesto",
        "body": "Attacker descubre API interna sin autenticaci√≥n (ni API key, ni OAuth, ni rate limit). Endpoint expon√≠a datos completos: IMSI, IMEI, nombre, direcci√≥n, SSN, tel√©fono. Una sola request ‚Üí 100k registros. Usado durante meses para scraping masivo.",
        "highlight_box": {
          "type": "danger",
          "text": "OWASP API Security Top 10 #1: Broken Object Level Authorization (BOLA) + #2: Broken Authentication"
        }
      }
    },
    {
      "screen_id": 3,
      "type": "crisis_timeline",
      "title": "‚è±Ô∏è MULTIPLES API BREACHES",
      "content": {
        "events": [
          {
            "time": "Ago 2021",
            "icon": "leak_add",
            "title": "Primer breach: 54M clientes",
            "description": "API sin auth expone datos completos. Vendido en foro por $270k.",
            "severity": "critical"
          },
          {
            "time": "2022",
            "icon": "bug_report",
            "title": "Segundo breach: 37M m√°s",
            "description": "Otra API olvidada (legacy) sin autenticaci√≥n ni rate limit.",
            "severity": "critical"
          },
          {
            "time": "Ene 2023",
            "icon": "security",
            "title": "T-Mobile implementa API Gateway + OAuth2",
            "description": "Despu√©s de 5 breaches, finalmente centralizan y securizan APIs.",
            "severity": "warning"
          }
        ]
      }
    },
    {
      "screen_id": 4,
      "type": "crisis_decision",
      "title": "üö® Nueva API interna",
      "content": {
        "scenario": "Dev crea nueva API para app interna. Quiere rapidez. Propone: 1) Sin auth (solo IP interna), 2) API Key, 3) OAuth2/mTLS. ¬øQu√© exiges?",
        "timer_seconds": 35,
        "options": [
          {
            "id": "no_auth",
            "text": "Sin auth (solo firewall IP)",
            "icon": "cloud_off",
            "is_correct": false,
            "consequence": {
              "title": "Esto fue T-Mobile",
              "description": "IPs se spoofean, VPNs se comprometen, servicios se mueven a cloud. 'Solo interno' = mito. 7 breaches reales.",
              "impact_score": -100
            }
          },
          {
            "id": "api_key",
            "text": "API Key por servicio",
            "icon": "vpn_key",
            "is_correct": false,
            "consequence": {
              "title": "Mejor, pero insuficiente",
              "description": "Keys se filtran en logs, c√≥digo, GitHub. No revocaci√≥n autom√°tica. T-Mobile usaba keys d√©biles.",
              "impact_score": 60
            }
          },
          {
            "id": "oauth_mtls",
            "text": "OAuth2 + mTLS + API Gateway centralizado",
            "icon": "shield",
            "is_correct": true,
            "consequence": {
              "title": "Defensa correcta",
              "description": "Token corto-lived, rotaci√≥n autom√°tica, certificado cliente obligatorio. Centralizado = visibilidad y control total.",
              "impact_score": 100,
              "xp_bonus": 30
            }
          }
        ]
      }
    },
    {
      "screen_id": 5,
      "type": "flip_card_full",
      "title": "OWASP API Security Top 10",
      "content": {
        "card": {
          "front": {"icon": "api", "term": "OWASP API TOP 10", "subtitle": "2023 Edition", "color": "#9C27B0"},
          "back": {
            "top_10": [
              "1. Broken Object Level Authorization (BOLA/IDOR)",
              "2. Broken Authentication",
              "3. Broken Object Property Level Authorization",
              "4. Unrestricted Resource Consumption",
              "5. Broken Function Level Authorization",
              "6. Unrestricted Access to Sensitive Business Flows",
              "7. Server Side Request Forgery (SSRF)",
              "8. Security Misconfiguration",
              "9. Improper Inventory of APIs",
              "10. Unsafe Consumption of APIs"
            ],
            "color": "#7B1FA2"
          }
        }
      }
    },
    {
      "screen_id": 6,
      "type": "flip_card_full",
      "title": "BOLA - Broken Object Level Auth",
      "content": {
        "card": {
          "front": {"icon": "person_off", "term": "BOLA / IDOR", "subtitle": "#1 API Top 10", "color": "#E91E63"},
          "back": {
            "definition": "Attacker manipula ID de objeto (user_id=123 ‚Üí 124) y accede a datos de otro usuario. API no valida ownership.",
            "example": "GET /api/v1/customers/45678 ‚Üí devuelve datos de otro cliente",
            "defense": "Server-side: validar que user_id pertenece al usuario autenticado. UUIDs > secuenciales.",
            "color": "#C2185B"
          }
        }
      }
    },
    {
      "screen_id": 7,
      "type": "flip_card_full",
      "title": "Rate Limiting & Abuse",
      "content": {
        "card": {
          "front": {"icon": "speed", "term": "RATE LIMITING", "subtitle": "Prevent scraping & DoS", "color": "#00BCD4"},
          "back": {
            "defense": [
              "Por IP + por API key + por usuario",
              "Leaky bucket o token bucket",
              "Bloqueo temporal tras X requests",
              "CAPTCHA tras umbral"
            ],
            "t_mobile_fail": "Sin rate limit ‚Üí attacker descarg√≥ 100M registros en d√≠as",
            "color": "#0097A7"
          }
        }
      }
    },
    {
      "screen_id": 8,
      "type": "flip_card_full",
      "title": "API Gateway + mTLS",
      "content": {
        "card": {
          "front": {"icon": "security", "term": "API GATEWAY + mTLS", "subtitle": "Zero Trust para APIs", "color": "#388E3C"},
          "back": {
            "benefits": "Centralizado, logging, auth, rate limit, schema validation, threat protection",
            "mtls": "Mutual TLS: cliente presenta certificado. IP spoofing ya no sirve.",
            "tools": "Kong, Apigee, AWS API Gateway, Azure API Management, Istio/Envoy",
            "color": "#2E7D32"
          }
        }
      }
    },
    {
      "screen_id": 9,
      "type": "drag_drop_match",
      "title": "OWASP API Top 10 Mapping",
      "content": {
        "instruction": "Relaciona el caso con el riesgo API Top 10:",
        "scenarios": [
          {"id": 1, "text": "Cambiar user_id=123 ‚Üí 456 y ver datos ajenos", "correct_target": "bola"},
          {"id": 2, "text": "API sin auth ni API key", "correct_target": "auth"},
          {"id": 3, "text": "100k requests/segundo ‚Üí scraping masivo", "correct_target": "rate"},
          {"id": 4, "text": "API antigua olvidada en producci√≥n", "correct_target": "inventory"},
          {"id": 5, "text": "GraphQL query muy profunda ‚Üí DoS", "correct_target": "consumption"}
        ],
        "targets": [
          {"id": "bola", "label": "BOLA", "color": "#E91E63"},
          {"id": "auth", "label": "Broken Auth", "color": "#F44336"},
          {"id": "rate", "label": "Unrestricted Consumption", "color": "#FF9800"},
          {"id": "inventory", "label": "Improper Inventory", "color": "#9C27B0"},
          {"id": "consumption", "label": "Resource Consumption", "color": "#00BCD4"}
        ],
        "xp_per_correct": 8
      }
    },
    {
      "screen_id": 10,
      "type": "swipe_cards",
      "title": "API Security: ¬øBuena pr√°ctica?",
      "content": {
        "instruction": "¬øEs segura esta pr√°ctica API?",
        "cards": [
          {"id": 1, "scenario": "API p√∫blica sin autenticaci√≥n", "correct_answer": "left"},
          {"id": 2, "scenario": "OAuth2 + short-lived tokens + refresh rotation", "correct_answer": "right"},
          {"id": 3, "scenario": "Rate limit solo por IP", "correct_answer": "left"},
          {"id": 4, "scenario": "mTLS obligatorio + API Gateway", "correct_answer": "right"},
          {"id": 5, "scenario": "API keys en query params (?key=123)", "correct_answer": "left"}
        ],
        "labels": {"left": "‚ùå PELIGROSA", "right": "‚úÖ SEGURA"},
        "xp_per_correct": 9
      }
    },
    {
      "screen_id": 11,
      "type": "log_hunter",
      "title": "üîç Hunt: API Abuse",
      "content": {
        "scenario": "Logs API Gateway. Encuentra las 2 l√≠neas sospechosas de scraping masivo.",
        "log_lines": [
          {"id": 1, "text": "2023-08-10 09:12:11 GET /api/customers/12345 200 user=app_mobile", "is_suspicious": false},
          {"id": 2, "text": "2023-08-10 14:23:58 GET /api/customers 200 ip=185.220.101.45 requests_last_hour=48732", "is_suspicious": true, "reason": "48k requests/hora desde IP externa = scraping masivo"},
          {"id": 3, "text": "2023-08-10 14:24:01 GET /api/customers 200 ip=185.220.101.45 requests_last_hour=49218", "is_suspicious": true, "reason": "Escalada de rate ‚Üí abuso claro"},
          {"id": 4, "text": "2023-08-10 15:01:33 POST /api/login 200 user=john.doe", "is_suspicious": false},
          {"id": 5, "text": "2023-08-10 16:30:22 GET /api/customers/789 200 user=app_backend", "is_suspicious": false}
        ],
        "xp_reward": 30
      }
    },
    {
      "screen_id": 12,
      "type": "timed_quiz",
      "title": "‚ö° T-Mobile Root Cause",
      "content": {
        "timer_seconds": 30,
        "question": "¬øRoot cause principal de los breaches T-Mobile?",
        "options": [
          {"id": "a", "text": "Los atacantes eran muy avanzados", "is_correct": false},
          {"id": "b", "text": "APIs sin autenticaci√≥n + sin rate limit + shadow APIs", "is_correct": true},
          {"id": "c", "text": "Empleados filtraron datos", "is_correct": false}
        ],
        "explanation": "7 breaches distintas por APIs olvidadas, sin auth, sin rate limit. Problema de gobernanza y arquitectura, no de sofisticaci√≥n atacante.",
        "xp_reward": 20
      }
    },
    {
      "screen_id": 13,
      "type": "timed_quiz",
      "title": "‚ö° BOLA Defense",
      "content": {
        "timer_seconds": 25,
        "question": "¬øMejor defensa contra BOLA/IDOR?",
        "options": [
          {"id": "a", "text": "Usar UUIDs en vez de IDs secuenciales", "is_correct": false},
          {"id": "b", "text": "Validar server-side que el usuario es due√±o del recurso", "is_correct": true}
        ],
        "explanation": "UUIDs ayudan, pero no son suficientes. Siempre validar ownership en backend.",
        "xp_reward": 20
      }
    },
    {
      "screen_id": 14,
      "type": "achievement_unlock",
      "title": "Logro Desbloqueado",
      "content": {
        "achievement": {
          "icon": "api",
          "name": "API Fortress",
          "description": "Dominas OWASP API Security Top 10 y defensa moderna",
          "rarity": "rare",
          "color": "#9C27B0"
        }
      }
    },
    {
      "screen_id": 15,
      "type": "lesson_complete",
      "title": "Lecci√≥n Completada",
      "content": {
        "xp_earned": 65,
        "key_takeaways": [
          "T-Mobile: 7 breaches por APIs sin auth, sin rate limit, shadow APIs",
          "OWASP API Top 10: BOLA #1, Broken Auth #2",
          "Defensas: OAuth2/mTLS, API Gateway centralizado, rate limiting, inventory",
          "Nunca conf√≠es en 'solo interno'. Zero Trust para APIs",
          "Rate limit por token + IP + usuario. Bloquea scraping"
        ],
        "next_lesson": {
          "id": "c4_l6",
          "title": "Container Security",
          "preview": "Tesla Kubernetes breach + mejores pr√°cticas"
        }
      }
    }
  ]
}