{
  "id": "c4_l7",
  "title": "Evaluaci√≥n Final Curso 4",
  "description": "Capstone: SecureBank FinTech Migration",
  "type": "interactive",
  "duration_minutes": 45,
  "xp_reward": 250,
  "order_index": 7,
  "course_id": 4,
  "total_screens": 15,
  "theme": {
    "primary_color": "#C62828",
    "secondary_color": "#FF6F00",
    "accent_color": "#388E3C",
    "gradient": ["#000000", "#1a0000", "#330000"]
  },
  "screens": [
    {
      "screen_id": 1,
      "type": "story_intro",
      "title": "Misi√≥n Final: SecureBank Migration",
      "content": {
        "headline": "FINTECH STARTUP UNICORN",
        "subheadline": "Migrar monolith legacy a microservicios seguros en Kubernetes",
        "stats": [
          {"value": "5M", "label": "Clientes activos"},
          {"value": "$2B", "label": "Transacciones anuales"},
          {"value": "PCI DSS", "label": "Level 1 + SOC2"},
          {"value": "90 d√≠as", "label": "Deadline migraci√≥n"}
        ],
        "cta_text": "Aceptar Misi√≥n como CISO"
      }
    },
    {
      "screen_id": 2,
      "type": "story_slide",
      "title": "SecureBank: El Desaf√≠o",
      "content": {
        "icon": "account_balance",
        "icon_color": "#C62828",
        "headline": "FinTech procesando tarjetas (PCI DSS Level 1)",
        "body": "Monolith legacy en datacenter propio. 15 a√±os de c√≥digo. Sin tests automatizados. Secrets en c√≥digo. Devs con acceso prod directo. Ahora migran a microservicios en AWS EKS (Kubernetes). 50 servicios, 200 developers, 5M clientes. Requisitos: PCI DSS Level 1, SOC2 Type II, zero-downtime migration, y cumplir deadline de 90 d√≠as.",
        "highlight_box": {
          "type": "danger",
          "text": "Tu misi√≥n: Dise√±ar pipeline DevSecOps completo, arquitectura segura, pol√≠ticas de seguridad, y presupuesto anual $1.2M."
        }
      }
    },
    {
      "screen_id": 3,
      "type": "crisis_decision",
      "title": "üéØ Decisi√≥n 1: SDLC Model",
      "content": {
        "scenario": "Equipo de 200 devs quiere seguir con 'deploy directo a prod'. Propones cambio radical. ¬øQu√© modelo impones?",
        "timer_seconds": 40,
        "options": [
          {
            "id": "waterfall",
            "text": "Waterfall + pentest anual",
            "icon": "waterfall_chart",
            "is_correct": false,
            "consequence": {
              "title": "Legacy thinking",
              "description": "Pentest anual encuentra vulns cuando ya est√°n en prod. Too late. PCI violation.",
              "impact_score": -80
            }
          },
          {
            "id": "shift_left",
            "text": "Shift-Left DevSecOps: Security desde d√≠a 1 en CI/CD",
            "icon": "security",
            "is_correct": true,
            "consequence": {
              "title": "Modern DevSecOps",
              "description": "SAST/DAST/SCA en cada PR. IaC scanning. Policy as Code. Security gates block deploys. Culture change.",
              "impact_score": 100,
              "xp_bonus": 30
            }
          },
          {
            "id": "devops_only",
            "text": "Solo DevOps (CI/CD r√°pido) sin security tools",
            "icon": "build",
            "is_correct": false,
            "consequence": {
              "title": "Velocidad sin seguridad",
              "description": "Deploy 100 veces al d√≠a... con SQLi y secrets. PCI auditor te mata.",
              "impact_score": -60
            }
          }
        ]
      }
    },
    {
      "screen_id": 4,
      "type": "crisis_decision",
      "title": "üéØ Decisi√≥n 2: Secrets Management",
      "content": {
        "scenario": "Auditor√≠a interna encuentra 400+ secrets hardcodeados en repos. ¬øQu√© implementas?",
        "timer_seconds": 35,
        "options": [
          {
            "id": "env_files",
            "text": "Pasar a .env files + gitignore",
            "icon": "description",
            "is_correct": false,
            "consequence": {
              "title": "Falso sentido de seguridad",
              "description": "Accidental commit pasa siempre. GitHub leaks continuos. Uber, Twilio, etc.",
              "impact_score": -90
            }
          },
          {
            "id": "vault_eks",
            "text": "HashiCorp Vault + External Secrets Operator en EKS",
            "icon": "lock",
            "is_correct": true,
            "consequence": {
              "title": "Enterprise standard",
              "description": "Secrets din√°micos, rotaci√≥n autom√°tica, audit log, JIT access. Integrado con K8s. Costo: $120K/a√±o.",
              "impact_score": 100,
              "xp_bonus": 30
            }
          }
        ]
      }
    },
    {
      "screen_id": 5,
      "type": "crisis_decision",
      "title": "üéØ Decisi√≥n 3: Container Security",
      "content": {
        "scenario": "Devs usan 'latest' tags y im√°genes gigantes. ¬øQu√© toolchain obligas?",
        "timer_seconds": 40,
        "options": [
          {
            "id": "trivy_only",
            "text": "Solo Trivy en CI",
            "icon": "scan",
            "is_correct": false,
            "consequence": {
              "title": "Parcial",
              "description": "Solo detecci√≥n est√°tica. Falta runtime, RBAC, admission control.",
              "impact_score": 40
            }
          },
          {
            "id": "full_stack",
            "text": "Trivy + Falco + Kyverno + PodSecurityStandards",
            "icon": "security",
            "is_correct": true,
            "consequence": {
              "title": "Defense in Depth completa",
              "description": "Imagen scanning, runtime security, policy enforcement, CIS benchmarks. Todo integrado.",
              "impact_score": 100,
              "xp_bonus": 30
            }
          }
        ]
      }
    },
    {
      "screen_id": 6,
      "type": "crisis_decision",
      "title": "üéØ Decisi√≥n 4: API Security",
      "content": {
        "scenario": "50 microservicios exponiendo APIs. Sin rate limit ni auth centralizada. ¬øQu√© deployas?",
        "timer_seconds": 35,
        "options": [
          {
            "id": "per_service",
            "text": "Cada equipo implementa auth como quiera",
            "icon": "diversity_3",
            "is_correct": false,
            "consequence": {
              "title": "Caos total",
              "description": "JWT mal firmados, API keys en c√≥digo, BOLA everywhere. PCI fail.",
              "impact_score": -100
            }
          },
          {
            "id": "gateway",
            "text": "API Gateway central (Kong/Apigee) + OAuth2/mTLS + rate limit",
            "icon": "api",
            "is_correct": true,
            "consequence": {
              "title": "Zero Trust APIs",
              "description": "Auth centralizada, rate limit, schema validation, observabilidad. OWASP API Top 10 cubierto.",
              "impact_score": 100,
              "xp_bonus": 30
            }
          }
        ]
      }
    },
    {
      "screen_id": 7,
      "type": "budget_allocation",
      "title": "üí∞ Budget Anual: $1.2M",
      "content": {
        "total_budget": 1200000,
        "categories": [
          {
            "id": "sast",
            "name": "SAST (Checkmarx)",
            "cost": 180000,
            "mandatory": true,
            "impact": "Detecta vulnerabilidades en c√≥digo propio antes de compilar."
          },
          {
            "id": "sca",
            "name": "SCA (Snyk)",
            "cost": 120000,
            "mandatory": true,
            "impact": "Detecta librer√≠as open source vulnerables (ej. Log4j)."
          },
          {
            "id": "vault",
            "name": "Vault Enterprise",
            "cost": 120000,
            "mandatory": true,
            "impact": "Gesti√≥n centralizada de secretos y certificados."
          },
          {
            "id": "apigw",
            "name": "API Gateway (Kong EE)",
            "cost": 150000,
            "mandatory": true,
            "impact": "Autenticaci√≥n, Rate Limiting y seguridad de borde."
          },
          {
            "id": "runtime",
            "name": "Runtime (Falco+Tetragon)",
            "cost": 80000,
            "mandatory": true,
            "impact": "Detecci√≥n de intrusiones en tiempo real (Kernel level)."
          },
          {
            "id": "policy",
            "name": "Policy as Code (Kyverno)",
            "cost": 50000,
            "mandatory": true,
            "impact": "Evita despliegues inseguros en Kubernetes."
          },
          {
            "id": "training",
            "name": "Secure Coding Training",
            "cost": 60000,
            "mandatory": false,
            "impact": "Educa a devs para no introducir bugs."
          },
          {
            "id": "bug_bounty",
            "name": "Bug Bounty Program",
            "cost": 100000,
            "mandatory": false,
            "impact": "Hackers √©ticos encuentran lo que las herramientas no ven."
          },
          {
            "id": "pentest",
            "name": "Quarterly Red Team",
            "cost": 200000,
            "mandatory": false,
            "impact": "Simulaci√≥n de ataque profundo y dirigido."
          }
        ],
        "optimal_allocation": [
          {"id": "sast", "selected": true},
          {"id": "sca", "selected": true},
          {"id": "vault", "selected": true},
          {"id": "apigw", "selected": true},
          {"id": "runtime", "selected": true},
          {"id": "policy", "selected": true},
          {"id": "training", "selected": true},
          {"id": "bug_bounty", "selected": true}
        ]
      }
    },
    {
      "screen_id": 8,
      "type": "drag_drop_match",
      "title": "OWASP Top 10 ‚Üí Herramienta",
      "content": {
        "instruction": "Relaciona cada riesgo con la herramienta que lo mitiga mejor",
        "scenarios": [
          {"id": 1, "text": "A03:2021 - Injection", "correct_target": "dast"},
          {"id": 2, "text": "A06:2021 - Vulnerable Components", "correct_target": "sca"},
          {"id": 3, "text": "A07:2021 - Identification Failure", "correct_target": "secrets"},
          {"id": 4, "text": "Broken Access Control", "correct_target": "authz"},
          {"id": 5, "text": "Security Misconfiguration", "correct_target": "iac"}
        ],
        "targets": [
          {"id": "dast", "label": "ZAP / DAST", "color": "#F44336"},
          {"id": "sca", "label": "Snyk / SCA", "color": "#FF9800"},
          {"id": "secrets", "label": "TruffleHog", "color": "#9C27B0"},
          {"id": "authz", "label": "OPA", "color": "#2196F3"},
          {"id": "iac", "label": "Checkov", "color": "#4CAF50"}
        ],
        "xp_per_correct": 10
      }
    },
    {
      "screen_id": 9,
      "type": "drag_drop_match",
      "title": "üîß Lab: Pipeline Seguro",
      "content": {
        "instruction": "Relaciona cada control de seguridad con su etapa correcta en el Pipeline.",
        "scenarios": [
          { "id": 1, "text": "Escaneo de secretos (TruffleHog)", "correct_target": "commit" },
          { "id": 2, "text": "An√°lisis est√°tico (SAST)", "correct_target": "pr" },
          { "id": 3, "text": "Escaneo de imagen Docker (Trivy)", "correct_target": "build" },
          { "id": 4, "text": "Dynamic Analysis (DAST)", "correct_target": "staging" },
          { "id": 5, "text": "Admission Controller (Kyverno)", "correct_target": "prod" }
        ],
        "targets": [
          { "id": "commit", "label": "1. Commit", "color": "#9E9E9E" },
          { "id": "pr", "label": "2. Pull Req", "color": "#2196F3" },
          { "id": "build", "label": "3. Build", "color": "#FFC107" },
          { "id": "staging", "label": "4. Staging", "color": "#FF5722" },
          { "id": "prod", "label": "5. Prod", "color": "#4CAF50" }
        ],
        "xp_per_correct": 10
      }
    },
    {
      "screen_id": 10,
      "type": "swipe_cards",
      "title": "Pr√°cticas DevSecOps",
      "content": {
        "instruction": "¬øEs pr√°ctica DevSecOps correcta?",
        "cards": [
          {"id": 1, "scenario": "Secrets en c√≥digo + gitignore", "correct_answer": "left"},
          {"id": 2, "scenario": "SAST en cada PR (blocking)", "correct_answer": "right"},
          {"id": 3, "scenario": "Imagen 'latest' en producci√≥n", "correct_answer": "left"},
          {"id": 4, "scenario": "API Gateway central con mTLS", "correct_answer": "right"},
          {"id": 5, "scenario": "Runtime security con Falco", "correct_answer": "right"}
        ],
        "labels": {"left": "‚ùå INACEPTABLE", "right": "‚úÖ OBLIGATORIO"},
        "xp_per_correct": 12
      }
    },
    {
      "screen_id": 11,
      "type": "log_hunter",
      "title": "üîç Hunt: Pipeline Breach",
      "content": {
        "instruction": "Analiza los logs de CI/CD. Selecciona las 3 l√≠neas que indican un riesgo de seguridad grave.",
        "scenario": "GitHub Actions logs de un pull request reciente.",
        "log_lines": [
          {
            "id": 1,
            "text": "SAST scan passed - 0 critical",
            "is_suspicious": false
          },
          {
            "id": 2,
            "text": "Secrets scan: AWS_KEY detected in src/config.js",
            "is_suspicious": true,
            "reason": "Hardcoded secret. Claves de AWS en c√≥digo fuente permiten acceso total a la infraestructura."
          },
          {
            "id": 3,
            "text": "Deploy to prod triggered by fork PR (external contributor)",
            "is_suspicious": true,
            "reason": "Untrusted input. Un colaborador externo nunca deber√≠a poder desplegar a producci√≥n sin revisi√≥n."
          },
          {
            "id": 4,
            "text": "Trivy scan: 15 critical CVEs",
            "is_suspicious": true,
            "reason": "Vulnerabilidades cr√≠ticas en dependencias. El pipeline debi√≥ fallar (Build Breaker)."
          },
          {
            "id": 5,
            "text": "Normal merge from main",
            "is_suspicious": false
          }
        ]
      }
    },
    {
      "screen_id": 12,
      "type": "timed_quiz",
      "title": "‚ö° Pregunta Final 1",
      "content": {
        "timer_seconds": 35,
        "question": "¬øShift-Left significa?",
        "options": [
          {"id": "a", "text": "Hacer security al final del proyecto", "is_correct": false},
          {"id": "b", "text": "Integrar seguridad desde las primeras etapas del SDLC", "is_correct": true}
        ],
        "explanation": "Shift-left significa mover la seguridad a la izquierda en la l√≠nea de tiempo del proyecto (al inicio), en lugar de dejarla para el final (derecha).",
        "xp_reward": 20
      }
    },
    {
      "screen_id": 13,
      "type": "timed_quiz",
      "title": "‚ö° Pregunta Final 2",
      "content": {
        "timer_seconds": 35,
        "question": "¬øPor qu√© 'latest' tag es peligroso en producci√≥n?",
        "options": [
          {"id": "a", "text": "Porque puede romper compatibilidad sin aviso", "is_correct": true},
          {"id": "b", "text": "Porque es m√°s lento", "is_correct": false}
        ],
        "explanation": "Usar 'latest' es impredecible. Una nueva versi√≥n puede introducir bugs o vulnerabilidades en cualquier momento. Siempre usa tags versionados y con digest (SHA).",
        "xp_reward": 20
      }
    },
    {
      "screen_id": 14,
      "type": "achievement_unlock",
      "title": "Logro Desbloqueado",
      "content": {
        "achievement": {
          "icon": "military_tech",
          "name": "DevSecOps Architect",
          "description": "Dise√±aste arquitectura DevSecOps completa para FinTech PCI Level 1",
          "rarity": "legendary",
          "color": "#FFD700"
        }
      }
    },
    {
      "screen_id": 15,
      "type": "lesson_complete",
      "title": "¬°Curso 4 Completado!",
      "content": {
        "xp_earned": 250,
        "key_takeaways": [
          "Shift-Left DevSecOps: Security desde el commit",
          "Pipeline completo: SAST/SCA/DAST/IaC/Runtime",
          "Secrets management con Vault + ESO",
          "API Gateway central + mTLS + rate limit",
          "Container security: Trivy + Falco + Kyverno + PSS",
          "Presupuesto realista $1.2M/a√±o para 200 devs"
        ],
        "next_lesson": {
          "id": "c5_l1",
          "title": "Curso 5: Respuesta a Incidentes",
          "preview": "Fases de IR, Forense y An√°lisis de Malware"
        }
      }
    }
  ]
}