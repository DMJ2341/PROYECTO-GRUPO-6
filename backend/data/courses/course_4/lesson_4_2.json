{
  "id": "c4_l2",
  "title": "SQL Injection",
  "description": "Caso Real: Target POS Breach (2013)",
  "type": "interactive",
  "duration_minutes": 24,
  "xp_reward": 55,
  "order_index": 2,
  "course_id": 4,
  "total_screens": 18,
  "theme": {
    "primary_color": "#CC0000",
    "secondary_color": "#FFFFFF",
    "accent_color": "#FFB74D",
    "gradient": ["#1a0505", "#330a0a", "#4d0f0f"]
  },
  "screens": [
    {
      "screen_id": 1,
      "type": "story_intro",
      "title": "Operaci√≥n: Holiday Breach",
      "content": {
        "headline": "NOVIEMBRE 2013",
        "subheadline": "Supply chain + POS malware = 40M credit cards stolen",
        "stats": [
          {"value": "40M", "label": "Credit cards stolen"},
          {"value": "70M", "label": "Customer records total"},
          {"value": "$18.5M", "label": "Settlement banks"}
        ],
        "cta_text": "Investigar Supply Chain Attack"
      }
    },
    {
      "screen_id": 2,
      "type": "story_slide",
      "title": "Supply Chain: Weakest Link",
      "content": {
        "icon": "hvac",
        "icon_color": "#CC0000",
        "headline": "Fazio Mechanical: HVAC Vendor ‚Üí Attack Vector",
        "body": "Target breach started con phishing a Fazio Mechanical (small HVAC vendor, 3 employees). Fazio ten√≠a VPN access a Target network para billing/monitoring. Stolen credentials ‚Üí Target network access. No segmentation: Vendor VPN acced√≠a corporate network directly. BlackPOS malware deployed en 1,800 POS terminals.",
        "highlight_box": {
          "type": "danger",
          "text": "Lesson: Third-party risk = your risk. Vendor access must be: scoped, monitored, time-limited. FireEye alert√≥ pero fue ignored (alert fatigue)."
        }
      }
    },
    {
      "screen_id": 3,
      "type": "crisis_timeline",
      "title": "‚è±Ô∏è SUPPLY CHAIN ‚Üí DATA EXFILTRATION",
      "content": {
        "events": [
          {
            "time": "Sep 2013",
            "icon": "phishing",
            "title": "Phishing: Fazio Mechanical",
            "description": "Attackers phish Fazio (HVAC vendor). Malware en workstation. Steal VPN credentials para Target network.",
            "severity": "warning"
          },
          {
            "time": "Nov 12",
            "icon": "vpn_key",
            "title": "Target Network Access",
            "description": "Login via Fazio VPN credentials. Access corporate network. No segmentation - vendor network = corporate network.",
            "severity": "critical"
          },
          {
            "time": "Nov 15",
            "icon": "bug_report",
            "title": "BlackPOS Malware Deployment",
            "description": "Deploy BlackPOS (RAM scraper) en 1,800 POS terminals. Malware scrapes credit card Track 1&2 data ANTES de encryption.",
            "severity": "critical"
          },
          {
            "time": "Nov 30 - Dec 15",
            "icon": "credit_card",
            "title": "Data Exfiltration (Black Friday)",
            "description": "Holiday shopping season. 40M credit/debit cards, 70M customer records stolen. Exfiltrated a servers en Brazil/Russia.",
            "severity": "critical"
          },
          {
            "time": "Dec 2",
            "icon": "warning",
            "title": "FireEye Alert IGNORED",
            "description": "FireEye (Target's security tool) detecta malware, alerta team. Alert dismissed as false positive. Breach contin√∫a 2 weeks+.",
            "severity": "critical"
          },
          {
            "time": "Dec 18",
            "icon": "report",
            "title": "Breach Discovered",
            "description": "US DOJ notifica Target despu√©s de que banks detectan fraudulent cards. Public disclosure Dec 19. Stock drop 46%.",
            "severity": "critical"
          }
        ]
      }
    },
    {
      "screen_id": 4,
      "type": "crisis_decision",
      "title": "üö® Third-Party Vendor Access",
      "content": {
        "scenario": "Eres CISO. HVAC vendor necesita network access para monitoring. Options: 1) Full corporate VPN, 2) Scoped access (billing systems only), 3) No remote access (onsite only). Engineering wants 'easy' option.",
        "timer_seconds": 35,
        "options": [
          {
            "id": "full_vpn",
            "text": "Full corporate network VPN access (easy deployment)",
            "icon": "all_inclusive",
            "is_correct": false,
            "consequence": {
              "title": "Esto fue Target",
              "description": "Fazio VPN ‚Üí full network access ‚Üí attackers lateral movement ‚Üí POS terminals ‚Üí 40M cards. Vendor compromise = your compromise. No segmentation = no containment.",
              "impact_score": -100
            }
          },
          {
            "id": "scoped_access",
            "text": "Scoped VPN: Access ONLY billing/monitoring systems. Firewall rules. MFA required.",
            "icon": "security",
            "is_correct": true,
            "consequence": {
              "title": "Least Privilege Applied",
              "description": "Vendor accede solo necessary systems. Firewall blocks lateral movement a POS/corporate network. Even si vendor compromised, blast radius limited. MFA + monitoring = defense in depth.",
              "impact_score": 100,
              "xp_bonus": 30
            }
          },
          {
            "id": "no_remote",
            "text": "No remote access - onsite visits only",
            "icon": "location_off",
            "is_correct": false,
            "consequence": {
              "title": "Operational Overhead",
              "description": "Secure pero impractical. HVAC monitoring requires remote access. Onsite = delays + cost. Balance needed between security y business needs.",
              "impact_score": 40
            }
          }
        ]
      }
    },
    {
      "screen_id": 5,
      "type": "flip_card_full",
      "title": "SQL Injection Basics",
      "content": {
        "card": {
          "front": {
            "icon": "data_object",
            "term": "SQL INJECTION",
            "subtitle": "OWASP A03: Injection",
            "color": "#D32F2F"
          },
          "back": {
            "definition": "Attacker inserta malicious SQL code en input fields. App concatena user input en SQL query sin validation. Result: Unauthorized database access, data theft, authentication bypass.",
            "classic_example": "Login form: username=' OR '1'='1 password=anything. Query: SELECT * FROM users WHERE user='' OR '1'='1' AND pass='x'. '1'='1' always true = bypass login.",
            "impact": [
              "Data breach: SELECT * FROM credit_cards",
              "Authentication bypass: ' OR '1'='1",
              "Data modification: '; DROP TABLE users;--",
              "OS command execution (via xp_cmdshell en SQL Server)"
            ],
            "color": "#C62828"
          }
        }
      }
    },
    {
      "screen_id": 6,
      "type": "flip_card_full",
      "title": "SQL Injection: Prepared Statements",
      "content": {
        "card": {
          "front": {
            "icon": "shield",
            "term": "PREPARED STATEMENTS",
            "subtitle": "Parameterized queries",
            "color": "#388E3C"
          },
          "back": {
            "definition": "Prepared statements (parameterized queries): SQL structure definida separately de data. Database treats user input as DATA, never as SQL code.",
            "vulnerable_code": "query = \"SELECT * FROM users WHERE user='\" + username + \"'\"; // BAD: String concatenation",
            "secure_code": "query = \"SELECT * FROM users WHERE user=?\"; stmt.setString(1, username); // GOOD: Parameterized",
            "how_it_works": "Database compiles query ANTES de insertar user data. User input = literal string, cannot alter SQL structure.",
            "language_support": "Java (PreparedStatement), Python (parameterized queries), PHP (PDO), .NET (SqlCommand with parameters). ALL modern languages support.",
            "color": "#2E7D32"
          }
        }
      }
    },
    {
      "screen_id": 7,
      "type": "flip_card_full",
      "title": "POS Malware: RAM Scraping",
      "content": {
        "card": {
          "front": {
            "icon": "memory",
            "term": "RAM SCRAPING",
            "subtitle": "Memory-resident malware",
            "color": "#FF6F00"
          },
          "back": {
            "definition": "POS (Point-of-Sale) malware scrapes credit card data from RAM. Cards est√°n en plaintext momentarily (milliseconds) ANTES de encryption.",
            "how_it_works": "Card swiped ‚Üí POS reads Track 1&2 data ‚Üí Momentarily en RAM (plaintext) ‚Üí App encrypts para transmission. Malware scans RAM, extracts plaintext card data antes de encryption.",
            "blackpos_target": "BlackPOS: Deployed en 1,800 Target POS terminals. Memory scraping cada transaction. Exfiltrated via FTP a external servers (Brazil, Russia).",
            "defense": [
              "P2PE (Point-to-Point Encryption): Encrypt desde card reader hardware",
              "Memory protection: Encrypt sensitive data in RAM",
              "Network segmentation: POS network isolated",
              "Endpoint detection: Detect RAM scraping behavior"
            ],
            "color": "#E65100"
          }
        }
      }
    },
    {
      "screen_id": 8,
      "type": "flip_card_full",
      "title": "Third-Party Risk Management",
      "content": {
        "card": {
          "front": {
            "icon": "business",
            "term": "TPRM",
            "subtitle": "Vendor security assessment",
            "color": "#1976D2"
          },
          "back": {
            "definition": "Third-Party Risk Management (TPRM): Process para assess y manage security risks de vendors/suppliers. Your security = weakest vendor's security.",
            "tprm_process": [
              "1. Inventory: List all vendors con network access",
              "2. Risk assessment: Criticality, data access, controls",
              "3. Security requirements: Contracts require MFA, patching, audits",
              "4. Access control: Scoped permissions, least privilege, monitoring",
              "5. Continuous monitoring: Periodic audits, breach notifications",
              "6. Incident response: Vendor breach = your incident"
            ],
            "target_failure": "Target: No segmentation para Fazio VPN. No monitoring. Vendor access = trusted network.",
            "color": "#1565C0"
          }
        }
      }
    },
    {
      "screen_id": 9,
      "type": "code_practice",
      "title": "üíª Identify SQL Injection",
      "content": {
        "instruction": "¬øCu√°l c√≥digo es vulnerable a SQL injection?",
        "code_snippets": [
          {
            "id": 1,
            "language": "python",
            "code": "query = \"SELECT * FROM products WHERE id=\" + product_id\ncursor.execute(query)",
            "is_vulnerable": true,
            "explanation": "String concatenation. Si product_id=' OR 1=1--, query becomes: SELECT * FROM products WHERE id='' OR 1=1-- (returns ALL products)."
          },
          {
            "id": 2,
            "language": "python",
            "code": "query = \"SELECT * FROM products WHERE id=?\"\ncursor.execute(query, (product_id,))",
            "is_vulnerable": false,
            "explanation": "Parameterized query. product_id treated as DATA, not SQL code. Safe."
          },
          {
            "id": 3,
            "language": "java",
            "code": "String query = \"SELECT * FROM users WHERE email='\" + email + \"'\";\nStatement stmt = conn.createStatement();\nstmt.executeQuery(query);",
            "is_vulnerable": true,
            "explanation": "String concatenation + Statement (not PreparedStatement). Vulnerable."
          },
          {
            "id": 4,
            "language": "java",
            "code": "String query = \"SELECT * FROM users WHERE email=?\";\nPreparedStatement pstmt = conn.prepareStatement(query);\npstmt.setString(1, email);\npstmt.executeQuery();",
            "is_vulnerable": false,
            "explanation": "PreparedStatement con parameter binding. Safe."
          }
        ],
        "xp_per_correct": 8
      }
    },
    {
      "screen_id": 10,
      "type": "drag_drop_match",
      "title": "SQL Injection Attack Types",
      "content": {
        "instruction": "Match el SQL injection type con su descripci√≥n:",
        "scenarios": [
          {"id": 1, "text": "Error-based: Database errors reveal structure", "correct_target": "error"},
          {"id": 2, "text": "Union-based: UNION SELECT para extract data de otras tablas", "correct_target": "union"},
          {"id": 3, "text": "Blind: No visible output, use true/false logic", "correct_target": "blind"},
          {"id": 4, "text": "Time-based: Use SLEEP() para infer true/false", "correct_target": "time"},
          {"id": 5, "text": "Out-of-band: Exfiltrate via DNS/HTTP requests", "correct_target": "oob"}
        ],
        "targets": [
          {"id": "error", "label": "Error-based SQLi", "color": "#D32F2F"},
          {"id": "union", "label": "Union-based SQLi", "color": "#7B1FA2"},
          {"id": "blind", "label": "Blind SQLi", "color": "#1976D2"},
          {"id": "time", "label": "Time-based Blind SQLi", "color": "#FF6F00"},
          {"id": "oob", "label": "Out-of-Band SQLi", "color": "#388E3C"}
        ],
        "xp_per_correct": 7
      }
    },
    {
      "screen_id": 11,
      "type": "swipe_cards",
      "title": "SQL Injection Defense: Effective?",
      "content": {
        "instruction": "¬øEs esta defensa efectiva contra SQL injection?",
        "cards": [
          {
            "id": 1,
            "scenario": "Input validation: Block ' (single quote) en all fields",
            "correct_answer": "left",
            "labels": {"left": "‚ùå INEFECTIVA", "right": "‚úÖ EFECTIVA"}
          },
          {
            "id": 2,
            "scenario": "Prepared statements (parameterized queries) everywhere",
            "correct_answer": "right",
            "labels": {"left": "‚ùå INEFECTIVA", "right": "‚úÖ EFECTIVA"}
          },
          {
            "id": 3,
            "scenario": "Escape special characters antes de SQL query",
            "correct_answer": "left",
            "labels": {"left": "‚ùå INEFECTIVA", "right": "‚úÖ EFECTIVA"}
          },
          {
            "id": 4,
            "scenario": "ORM (Object-Relational Mapping) con parameterized queries",
            "correct_answer": "right",
            "labels": {"left": "‚ùå INEFECTIVA", "right": "‚úÖ EFECTIVA"}
          },
          {
            "id": 5,
            "scenario": "Least privilege database user (SELECT only, no DROP)",
            "correct_answer": "right",
            "labels": {"left": "‚ùå INEFECTIVA", "right": "‚úÖ EFECTIVA"}
          }
        ],
        "xp_per_correct": 9
      }
    },
    {
      "screen_id": 12,
      "type": "flip_card_full",
      "title": "Alert Fatigue",
      "content": {
        "card": {
          "front": {
            "icon": "notifications_off",
            "term": "ALERT FATIGUE",
            "subtitle": "Too many false positives",
            "color": "#F57C00"
          },
          "back": {
            "definition": "Alert fatigue: Security tools generate SO MANY alerts (90%+ false positives) que analysts ignore/dismiss real threats.",
            "target_failure": "Target ten√≠a FireEye (top-tier EDR). FireEye DETECTED BlackPOS malware, alert√≥ team. Alert dismissed as false positive. Breach continu√≥ 2+ weeks.",
            "causes": [
              "Poor tuning: Default rules generate noise",
              "No prioritization: All alerts treated equal",
              "Lack of context: Alert sin actionable info",
              "Understaffed SOC: Too many alerts, too few analysts"
            ],
            "solutions": "Tune alerts (reduce FPs). SOAR (automation). Threat intelligence (prioritize). Hire/train analysts. Accept some risk (not ALL alerts need investigation).",
            "color": "#EF6C00"
          }
        }
      }
    },
    {
      "screen_id": 13,
      "type": "log_hunter",
      "title": "üîç Hunt: SQL Injection Attempt",
      "content": {
        "scenario": "Web app logs. Find las 2 lines que indican SQL injection attack.",
        "log_lines": [
          {"id": 1, "text": "2024-12-01 14:23:11 GET /products?id=123 200 OK user=customer@example.com", "is_suspicious": false},
          {"id": 2, "text": "2024-12-01 14:45:33 GET /products?id=' OR '1'='1 500 ERROR SQL_SYNTAX_ERROR user=unknown", "is_suspicious": true, "reason": "Classic SQL injection payload: ' OR '1'='1. 500 error indica SQL syntax error."},
          {"id": 3, "text": "2024-12-01 14:46:12 GET /products?id=1 UNION SELECT user,password FROM admin-- 200 OK user=unknown", "is_suspicious": true, "reason": "UNION-based SQL injection: Attempting to extract admin credentials."},
          {"id": 4, "text": "2024-12-01 15:02:15 GET /products?id=456 200 OK user=customer2@example.com", "is_suspicious": false},
          {"id": 5, "text": "2024-12-01 15:15:42 POST /login username=admin password=correct 200 OK session_created", "is_suspicious": false}
        ],
        "xp_reward": 25
      }
    },
    {
      "screen_id": 14,
      "type": "slider_balance",
      "title": "‚öñÔ∏è Acceso de Proveedores",
      "content": {
        "scenario": "Un proveedor necesita acceso para mantenimiento. ¬øC√≥mo se lo das?",
        "left_option": {
          "label": "VPN Permanente",
          "icon": "vpn_key",
          "consequences": [
            "‚úÖ F√°cil para el proveedor",
            "‚ùå Puerta trasera abierta 24/7",
            "‚ùå Si hackean al proveedor, te hackean a ti"
          ]
        },
        "right_option": {
          "label": "Acceso Just-In-Time (JIT)",
          "icon": "timer",
          "consequences": [
            "‚úÖ Ventana de acceso limitada",
            "‚úÖ Monitoreado y grabado",
            "‚úÖ Riesgo m√≠nimo"
          ]
        },
        "explanation": "El acceso de terceros debe ser ef√≠mero y vigilado. Target fue hackeado por una VPN permanente de un proveedor de aire acondicionado."
      }
    },
    {
      "screen_id": 15,
      "type": "timed_quiz",
      "title": "‚ö° Target Root Cause",
      "content": {
        "timer_seconds": 30,
        "question": "¬øQu√© fue el root cause del Target breach?",
        "options": [
          {"id": "a", "text": "SQL injection en web app", "is_correct": false},
          {"id": "b", "text": "Supply chain: Vendor VPN sin segmentation + POS malware + alert fatigue", "is_correct": true},
          {"id": "c", "text": "Insiders robaron credit cards", "is_correct": false}
        ],
        "explanation": "Root causes: 1) Fazio (vendor) VPN con full network access (no segmentation), 2) BlackPOS malware en POS terminals (RAM scraping), 3) FireEye alerts ignored (alert fatigue). Multi-factor failure.",
        "xp_reward": 20
      }
    },
    {
      "screen_id": 16,
      "type": "timed_quiz",
      "title": "‚ö° SQL Injection Prevention",
      "content": {
        "timer_seconds": 25,
        "question": "¬øCu√°l es la defensa M√ÅS efectiva contra SQL injection?",
        "options": [
          {"id": "a", "text": "Input validation (block special characters)", "is_correct": false},
          {"id": "b", "text": "Prepared statements (parameterized queries)", "is_correct": true},
          {"id": "c", "text": "Firewall (WAF) con SQL injection rules", "is_correct": false}
        ],
        "explanation": "Prepared statements = gold standard. Database treats user input as DATA, never SQL code. Input validation puede ser bypassed. WAF es defense in depth pero not primary defense. ALWAYS use parameterized queries.",
        "xp_reward": 20
      }
    },
    {
      "screen_id": 17,
      "type": "achievement_unlock",
      "title": "Logro Desbloqueado",
      "content": {
        "achievement": {
          "icon": "code",
          "name": "SQL Injection Master",
          "description": "Dominas SQL injection attacks & defense + supply chain security",
          "rarity": "rare",
          "color": "#CC0000"
        }
      }
    },
    {
      "screen_id": 18,
      "type": "lesson_complete",
      "title": "Lecci√≥n Completada",
      "content": {
        "xp_earned": 55,
        "key_takeaways": [
          "Target: 40M cards stolen. Fazio vendor VPN ‚Üí no segmentation ‚Üí BlackPOS malware.",
          "SQL Injection (OWASP A03): Malicious SQL en input. Bypass auth, steal data.",
          "Defense: Prepared statements (parameterized queries). NEVER string concatenation.",
          "POS malware: RAM scraping (plaintext cards). P2PE defense (Point-to-Point Encryption).",
          "Third-Party Risk: Vendor security = your security. Scoped access, monitoring, MFA.",
          "Alert Fatigue: FireEye detected pero ignored. Tune alerts, reduce false positives."
        ],
        "next_lesson": {
          "id": "c4_l3",
          "title": "Cross-Site Scripting (XSS)",
          "preview": "Stored XSS, Reflected XSS, DOM-based XSS defense"
        }
      }
    }
  ]
}