# La línea 'version: 3.8' se ha eliminado por ser obsoleta
services:
  # 1. El servicio/caja para tu Backend de Python/Flask
  backend:
    build: ./backend  # Le dice a Docker que busque el Dockerfile en la carpeta ./backend
    container_name: cyberlearn_backend
    ports:
      # Mapea el puerto 5000 de tu PC (Host) al puerto 5000 del Contenedor
      - "5000:5000"
    volumes:
      # Enlaza tu carpeta ./backend con /app dentro del contenedor.
      - ./backend:/app
    environment:
      # Esta es la variable de entorno que tu app.py usa para encontrar la BD
      - DATABASE_URL=postgresql://cyberlearn_user:supersecretpassword@db:5432/cyberlearn_db
    depends_on:
      - db # Le dice a Docker que inicie la BD primero, y luego el backend

  # 2. El servicio/caja para tu Base de Datos PostgreSQL
  db:
    image: postgres:15-alpine # Usa una imagen oficial y ligera de PostgreSQL
    container_name: cyberlearn_db
    environment:
      # Estas son las credenciales que usará la base de datos
      POSTGRES_USER: cyberlearn_user
      POSTGRES_PASSWORD: supersecretpassword
      POSTGRES_DB: cyberlearn_db
    volumes:
      # Guarda los datos de la BD en una carpeta local 'database-data'
      - database-data:/var/lib/postgresql/data
    ports:
      # Opcional: Si quieres conectarte a la BD con DBeaver o pgAdmin
      - "5432:5432"

# 3. Definición del volumen persistente para la base de datos
volumes:
  database-data: